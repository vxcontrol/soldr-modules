{
    "replace_current_sysmon_binary": true,
    "replace_current_sysmon_config": true,
    "sysmon_config": "\u003c!--\n  sysmon-config | A Sysmon configuration focused on default high-quality event tracing and easy customization by the community\n  Source version:\t71 | Date: 2020-01-16\n  Source project:\thttps://github.com/SwiftOnSecurity/sysmon-config\n  Source license:\tCreative Commons Attribution 4.0 | You may privatize, fork, edit, teach, publish, or deploy for commercial use - with attribution in the text.\n\n  Fork version:\t\u003cN/A\u003e\n  Fork author:\t\u003cN/A\u003e\n  Fork project:\t\u003cN/A\u003e\n  Fork license:\t\u003cN/A\u003e\n\n  REQUIRED: Sysmon version 10.0.4.1 or higher (due to changes in syntax and bug-fixes)\n\thttps://docs.microsoft.com/en-us/sysinternals/downloads/sysmon\n\n  NOTE: To collect Sysmon logs centrally for free, see https://aka.ms/WEF | Command to allow log access to the Network Service:\n\twevtutil.exe sl Microsoft-Windows-Sysmon/Operational /ca:O:BAG:SYD:(A;;0xf0005;;;SY)(A;;0x5;;;BA)(A;;0x1;;;S-1-5-32-573)(A;;0x1;;;NS)\n\n  NOTE: Do not let the size and complexity of this configuration discourage you from customizing it or building your own.\n\tThis configuration is based around known, high-signal event tracing, and thus appears complicated, but it is only very\n\tdetailed. Significant effort over years has been invested in front-loading as much filtering as possible onto the\n\tclient. This is to make analysis of intrusions possible by hand, and to try to surface anomalous activity as quickly\n\tas possible to technicians armed only with Event Viewer. Its purpose is to democratize system monitoring for all organizations.\n\n  NOTE: Sysmon is NOT a whitelist solution or HIDS correlation engine, it is a computer change logging tool.\n\tDo NOT ignore everything possible. Sysmon's purpose is providing context during a threat or problem investigation. Legitimate\n\tprocesses are routinely used by threats - do not blindly exclude them. Additionally, be mindful of process-hollowing / imitation.\n\n  NOTE: By default this monitors DNS, which is extremely noisy. If you are starting out on your monitoring journey, just remove that section.\n\tYou can remove DNS events from Event Viewer screen by applying a 'Filter Current View' for event IDs of: -22\n\tAdditionally, if you want to monitor DNS, you should deploy client-side adblocking to reduce lookups. See the DNS section for info.\n\n  NOTE: This configuration is designed for PER-MACHINE installs of Chrome and OneDrive. That moves their binaries out of user-controlled folders.\n\tOtherwise, attackers could imitate these common applications, and bypass your logging. Below are silent upgrades you can do, no user impact:\n\t- https://docs.microsoft.com/en-us/onedrive/per-machine-installation\n\t- https://cloud.google.com/chrome-enterprise/browser/download/\n\t- As of 2019-08-25 there is no usermode version of Microsoft Teams.\n\n  NOTE: Sysmon is not hardened against an attacker with admin rights. Additionally, this configuration offers an attacker, willing\n\tto study it, limited ways to evade some of the logging. If you are in a very high-threat environment, you should consider a broader,\n\tlog-most approach. However, in the vast majority of cases, an attacker will bumble through multiple behavioral traps which\n\tthis configuration monitors, especially in the first minutes. Even APT do not send their A-team unless they know you're hardened.\n\t5% of the effort gets 95% of the results. APT rely on nobody watching because almost nobody does. Your effort makes the difference.\n\n  NOTE: If you encounter unexplainable event inclusion/exclusion, you may have a second Sysmon instance installed under a different exe filename.\n\tTo clear this, try downloading the latest version and uninstalling with -u force. If it hangs, kill the processes and run it again to cleanup.\n\n  TECHNICAL:\n  - Run sysmon.exe -? for a briefing on Sysmon configuration.\n  - Sysmon XML cannot use the AMPERSAND sign. Replace it with this: \u0026amp;\n  - Sysmon 8+ can track which rule caused an event to be logged through the \"RuleName\" field.\n  - If you only specify exclude for a filtering subsection, everything in that subsection is logged by default.\n  - Some Sysmon monitoring abilities are not meant for widely deployed general-purpose use due to performance impact. Depends on environment.\n  - Duplicate or overlapping \"Include\" rules do not result in duplicate events being logged.\n  - All characters enclosed by XML tags are always interpreted literally. Sysmon does not support wildcards (*), alternate characters, or RegEx.\n  - In registry events, the value name is appended to the full key path with a \"\\\" delimiter. Default key values are named \"\\(Default)\"\n  - \"Image\" is a technical term for a compiled binary file like an EXE or DLL. Also, it can match just the filename, or entire path.\n  - \"ProcessGuid\" and \"LoginGuid\" are not random, they contain some embedded information. https://gist.github.com/mattifestation/0102042160c9a60b2b847378c0ef70b4\n\n  FILTERING: Filter conditions available for use are: is, is not, contains, excludes, begin with, end with, less than, more than, image\n  - The \"image\" filter is usable on any field. Same as \"is\" but can either match entire string, or only the text after last \"\\\". Credit: @mattifestation\n\n--\u003e\n\n\u003cSysmon schemaversion=\"4.50\"\u003e\n\t\u003c!--SYSMON META CONFIG--\u003e\n\t\u003cHashAlgorithms\u003emd5,sha256,IMPHASH\u003c/HashAlgorithms\u003e \u003c!-- Both MD5 and SHA256 are the industry-standard algorithms for identifying files --\u003e\n\t\u003cCheckRevocation/\u003e \u003c!-- Check loaded drivers, log if their code-signing certificate has been revoked, in case malware stole one to sign a kernel driver --\u003e\n\n\t\u003c!-- \u003cImageLoad/\u003e --\u003e \u003c!-- Would manually force-on ImageLoad monitoring, even without configuration below. Included only documentation. --\u003e\n\t\u003c!-- \u003cProcessAccessConfig/\u003e --\u003e \u003c!-- Would manually force-on ProcessAccess monitoring, even without configuration below. Included only documentation. --\u003e\n\t\u003c!-- \u003cPipeMonitoringConfig/\u003e --\u003e \u003c!-- Would manually force-on PipeCreated / PipeConnected events, even without configuration below. Included only documentation. --\u003e\n\n\t\u003cEventFiltering\u003e\n\n\t\u003c!--SYSMON EVENT ID 1 : PROCESS CREATION [ProcessCreate]--\u003e\n\t\t\u003c!--COMMENT:\tAll processes launched will be logged, except for what matches a rule below. It's best to be as specific as possible,\n\t\t\tto avoid user-mode executables imitating other process names to avoid logging, or if malware drops files in an existing directory.\n\t\t\tUltimately, you must weigh CPU time checking many detailed rules, against the risk of malware exploiting the blindness created.\n\t\t\tBeware of Masquerading, where attackers imitate the names and paths of legitimate tools. Ideally, you'd use both file path and\n\t\t\tcode signatures to validate, but Sysmon does not support that. Look into AppLocker/WindowsDeviceGuard for whitelisting support. --\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessID, Image, FileVersion, Description, Product, Company, CommandLine, CurrentDirectory, User, LogonGuid, LogonId, TerminalSessionId, IntegrityLevel, Hashes, ParentProcessGuid, ParentProcessId, ParentImage, ParentCommandLine, RuleName--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cProcessCreate onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--SECTION: Microsoft Windows--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003e \"C:\\Windows\\system32\\wermgr.exe\" \"-queuereporting_svc\" \u003c/CommandLine\u003e \u003c!--Windows:Windows error reporting/telemetry--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003eC:\\Windows\\system32\\DllHost.exe /Processid\u003c/CommandLine\u003e \u003c!--Windows--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003eC:\\Windows\\system32\\wbem\\wmiprvse.exe -Embedding\u003c/CommandLine\u003e \u003c!--Windows: WMI provider host--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003eC:\\Windows\\system32\\wbem\\wmiprvse.exe -secured -Embedding\u003c/CommandLine\u003e \u003c!--Windows: WMI provider host--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\wermgr.exe -upload\u003c/CommandLine\u003e \u003c!--Windows:Windows error reporting/telemetry--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\SearchIndexer.exe /Embedding\u003c/CommandLine\u003e \u003c!--Windows: Search Indexer--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\windows\\system32\\wermgr.exe -queuereporting\u003c/CommandLine\u003e \u003c!--Windows:Windows error reporting/telemetry--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003e\\??\\C:\\Windows\\system32\\autochk.exe *\u003c/CommandLine\u003e \u003c!--Microsoft:Bootup: Auto Check Utility--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003e\\SystemRoot\\System32\\smss.exe\u003c/CommandLine\u003e \u003c!--Microsoft:Bootup: Windows Session Manager--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\RuntimeBroker.exe -Embedding\u003c/CommandLine\u003e \u003c!--Windows:Apps permissions [ https://fossbytes.com/runtime-broker-process-windows-10/ ] --\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files (x86)\\Common Files\\microsoft shared\\ink\\TabTip32.exe\u003c/Image\u003e \u003c!--Windows: Touch Keyboard and Handwriting Panel Helper--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\System32\\TokenBrokerCookies.exe\u003c/Image\u003e \u003c!--Windows: SSO sign-in assistant for MicrosoftOnline.com--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\System32\\plasrv.exe\u003c/Image\u003e \u003c!--Windows: Performance Logs and Alerts DCOM Server--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\System32\\wifitask.exe\u003c/Image\u003e \u003c!--Windows: Wireless Background Task--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\CompatTelRunner.exe\u003c/Image\u003e \u003c!--Windows: Customer Experience Improvement--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\PrintIsolationHost.exe\u003c/Image\u003e \u003c!--Windows: Printing--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\SppExtComObj.Exe\u003c/Image\u003e \u003c!--Windows: KMS activation--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\audiodg.exe\u003c/Image\u003e \u003c!--Windows: Launched constantly--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\conhost.exe\u003c/Image\u003e \u003c!--Windows: Command line interface host process--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\mobsync.exe\u003c/Image\u003e \u003c!--Windows: Network file syncing--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\musNotification.exe\u003c/Image\u003e \u003c!--Windows: Update pop-ups--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\musNotificationUx.exe\u003c/Image\u003e \u003c!--Windows: Update pop-ups--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\powercfg.exe\u003c/Image\u003e \u003c!--Microsoft:Power configuration management--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\sndVol.exe\u003c/Image\u003e \u003c!--Windows: Volume control--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\sppsvc.exe\u003c/Image\u003e \u003c!--Windows: Software Protection Service--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\wbem\\WmiApSrv.exe\u003c/Image\u003e \u003c!--Windows: WMI performance adapter host process--\u003e\n\t\t\t\u003cIntegrityLevel condition=\"is\"\u003eAppContainer\u003c/IntegrityLevel\u003e \u003c!--Windows: Don't care about sandboxed processes right now. Will need to revisit this decision.--\u003e\n\t\t\t\u003cParentCommandLine condition=\"begin with\"\u003e%%SystemRoot%%\\system32\\csrss.exe ObjectDirectory=\\Windows\u003c/ParentCommandLine\u003e \u003c!--Windows:CommandShell: Triggered when programs use the command shell, but doesn't provide attribution for what caused it--\u003e\n\t\t\t\u003cParentCommandLine condition=\"is\"\u003eC:\\windows\\system32\\wermgr.exe -queuereporting\u003c/ParentCommandLine\u003e \u003c!--Windows:Windows error reporting/telemetry--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\WINDOWS\\system32\\devicecensus.exe UserCxt\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\usocoreworker.exe -Embedding\u003c/CommandLine\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Windows\\system32\\SearchIndexer.exe\u003c/ParentImage\u003e \u003c!--Windows:Search: Launches many uninteresting sub-processes--\u003e\n\t\t\t\u003c!--SECTION: Windows:svchost--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k appmodel -s StateRepository\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k appmodel -p -s camsvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k appmodel\u003c/CommandLine\u003e \u003c!--Windows 10--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k appmodel -p -s tiledatamodelsvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k camera -s FrameServer\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k dcomlaunch -s LSM\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k dcomlaunch -s PlugPlay\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k defragsvc\u003c/CommandLine\u003e \u003c!--Windows defragmentation--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k devicesflow -s DevicesFlowUserSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k imgsvc\u003c/CommandLine\u003e \u003c!--Microsoft:The Windows Image Acquisition Service--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localService -s EventSystem\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localService -s bthserv\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k LocalService -p -s BthAvctpSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localService -s nsi\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localService -s w32Time\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceAndNoImpersonation\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted -s Dhcp\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted -s EventLog\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted -s TimeBrokerSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted -s WFDSConMgrSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k LocalServiceNetworkRestricted -s BTAGService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\svchost.exe -k LocalSystemNetworkRestricted -p -s NcbService\u003c/CommandLine\u003e \u003c!--Win10:1903:Network Connection Broker--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceAndNoImpersonation -s SensrSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceAndNoImpersonation -p -s SSDPSRV\u003c/CommandLine\u003e \u003c!--Windows:SSDP [ https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNoNetwork\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -p -s WPDBusEnum\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -p -s fhsvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s DeviceAssociationService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s NcbService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s SensorService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s TabletInputService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s UmRdpService\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s WPDBusEnum\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -p -s NgcSvc\u003c/CommandLine\u003e \u003c!--Microsoft:Passport--\u003e \n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceNetworkRestricted -p -s NgcCtnrSvc\u003c/CommandLine\u003e \u003c!--Microsoft:Passport Container--\u003e \n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localServiceAndNoImpersonation -s SCardSvr\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -p -s wuauserv\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\svchost.exe -k netsvcs -p -s SessionEnv\u003c/CommandLine\u003e \u003c!--Windows:Remote desktop configuration--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted -s WdiSystemHost\u003c/CommandLine\u003e \u003c!--Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\svchost.exe -k localSystemNetworkRestricted -p -s WdiSystemHost\u003c/CommandLine\u003e \u003c!--Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted\u003c/CommandLine\u003e \u003c!--Windows--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -p -s wlidsvc\u003c/CommandLine\u003e \u003c!--Windows: Windows Live Sign-In Assistant [ https://www.howtogeek.com/howto/30348/what-are-wlidsvc.exe-and-wlidsvcm.exe-and-why-are-they-running/ ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -p -s ncaSvc\u003c/CommandLine\u003e \u003c!--Windows: Network Connectivity Assistant [ http://www.blackviper.com/windows-services/network-connectivity-assistant/ ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s BDESVC\u003c/CommandLine\u003e \u003c!--Windows:Network: BitLocker Drive Encryption--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\svchost.exe -k netsvcs -p -s BDESVC\u003c/CommandLine\u003e \u003c!--Microsoft:Win10:1903:Network: BitLocker Drive Encryption--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -p -s BITS\u003c/CommandLine\u003e \u003c!--Windows:Network: Background Intelligent File Transfer (BITS) --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s BITS\u003c/CommandLine\u003e \u003c!--Windows:Network: Background Intelligent File Transfer (BITS) --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s CertPropSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s DsmSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Appinfo\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s Gpsvc\u003c/CommandLine\u003e \u003c!--Windows:Network: Group Policy --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s ProfSvc\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s SENS\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s SessionEnv\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s Themes\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs -s Winmgmt\u003c/CommandLine\u003e \u003c!--Windows: Windows Management Instrumentation (WMI) --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService -p -s DoSvc\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService -s Dnscache\u003c/CommandLine\u003e \u003c!--Windows:Network: DNS caching, other uses --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService -s LanmanWorkstation\u003c/CommandLine\u003e \u003c!--Windows:Network: \"Workstation\" service, used for SMB file-sharing connections and RDP--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService -s NlaSvc\u003c/CommandLine\u003e \u003c!--Windows:Network: Network Location Awareness--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService -s TermService\u003c/CommandLine\u003e \u003c!--Windows:Network: Terminal Services (RDP)--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkService\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k networkServiceNetworkRestricted\u003c/CommandLine\u003e \u003c!--Windows: Network services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k rPCSS\u003c/CommandLine\u003e \u003c!--Windows Services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k secsvcs\u003c/CommandLine\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k swprv\u003c/CommandLine\u003e \u003c!--Microsoft:Software Shadow Copy Provider--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k unistackSvcGroup\u003c/CommandLine\u003e \u003c!--Windows 10--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k utcsvc\u003c/CommandLine\u003e \u003c!--Windows Services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k wbioSvcGroup\u003c/CommandLine\u003e \u003c!--Windows Services--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k werSvcGroup\u003c/CommandLine\u003e \u003c!--Windows: ErrorReporting--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k wusvcs -p -s WaaSMedicSvc\u003c/CommandLine\u003e \u003c!--Windows: Update Medic Service [ https://www.thewindowsclub.com/windows-update-medic-service ] --\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\System32\\svchost.exe -k wsappx -p -s ClipSVC\u003c/CommandLine\u003e \u003c!--Windows:Apps: Client License Service--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k wsappx -p -s AppXSvc\u003c/CommandLine\u003e \u003c!--Windows:Apps: AppX Deployment Service--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k wsappx -s ClipSVC\u003c/CommandLine\u003e \u003c!--Windows:Apps: Client License Service--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k wsappx\u003c/CommandLine\u003e \u003c!--Windows:Apps [ https://www.howtogeek.com/320261/what-is-wsappx-and-why-is-it-running-on-my-pc/ ] --\u003e\n\t\t\t\u003cParentCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k netsvcs\u003c/ParentCommandLine\u003e \u003c!--Windows: Network services: Spawns Consent.exe--\u003e\n\t\t\t\u003cParentCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe -k localSystemNetworkRestricted\u003c/ParentCommandLine\u003e \u003c!--Windows--\u003e\n\t\t\t\u003cCommandLine condition=\"is\"\u003eC:\\Windows\\system32\\deviceenroller.exe /c /AutoEnrollMDM\u003c/CommandLine\u003e \u003c!--Windows: AzureAD device enrollment agent--\u003e\n\t\t\t\u003c!--SECTION: Microsoft:Edge--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003e\"C:\\Program Files (x86)\\Microsoft\\Edge Dev\\Application\\msedge.exe\" --type=\u003c/CommandLine\u003e\n\t\t\t\u003c!--SECTION: Microsoft:dotNet--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003eC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe\u003c/CommandLine\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003eC:\\WINDOWS\\Microsoft.NET\\Framework64\\v4.0.30319\\Ngen.exe\u003c/CommandLine\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe\u003c/Image\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe\u003c/Image\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\Microsoft.Net\\Framework64\\v3.0\\WPF\\PresentationFontCache.exe\u003c/Image\u003e \u003c!--Windows: Font cache service--\u003e\n\t\t\t\u003cParentCommandLine condition=\"contains\"\u003eC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngentask.exe\u003c/ParentCommandLine\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsvw.exe\u003c/ParentImage\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\ngentask.exe\u003c/ParentImage\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\mscorsvw.exe\u003c/ParentImage\u003e \u003c!--Microsoft:DotNet--\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngentask.exe\u003c/ParentImage\u003e \u003c!--Microsoft:DotNet: Spawns thousands of ngen.exe processes--\u003e\n\t\t\t\u003c!--SECTION: Microsoft:Office--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Microsoft Office\\Office16\\MSOSYNC.EXE\u003c/Image\u003e \u003c!--Microsoft:Office: Background process for SharePoint/Office365 connectivity--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files (x86)\\Microsoft Office\\Office16\\MSOSYNC.EXE\u003c/Image\u003e \u003c!--Microsoft:Office: Background process for SharePoint/Office365 connectivity--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Common Files\\Microsoft Shared\\OfficeSoftwareProtectionPlatform\\OSPPSVC.EXE\u003c/Image\u003e \u003c!--Microsoft:Office: Licensing service--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Microsoft Office\\Office16\\msoia.exe\u003c/Image\u003e \u003c!--Microsoft:Office: Telemetry collector--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files (x86)\\Microsoft Office\\root\\Office16\\officebackgroundtaskhandler.exe\u003c/Image\u003e\n\t\t\t\u003c!--SECTION: Microsoft:Office:Click2Run--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeC2RClient.exe\u003c/Image\u003e \u003c!--Microsoft:Office: Background process--\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeClickToRun.exe\u003c/ParentImage\u003e \u003c!--Microsoft:Office: Background process--\u003e\n\t\t\t\u003cParentImage condition=\"is\"\u003eC:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeC2RClient.exe\u003c/ParentImage\u003e \u003c!--Microsoft:Office: Background process--\u003e\n\t\t\t\u003c!--SECTION: Windows: Media player--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Windows Media Player\\wmpnscfg.exe\u003c/Image\u003e \u003c!--Windows: Windows Media Player Network Sharing Service Configuration Application--\u003e\n\t\t\t\u003c!--SECTION: Google--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003e\"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\" --type=\u003c/CommandLine\u003e \u003c!--Google:Chrome: massive command-line arguments--\u003e\n\t\t\t\u003cCommandLine condition=\"begin with\"\u003e\"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\" --type=\u003c/CommandLine\u003e \u003c!--Google:Chrome: massive command-line arguments--\u003e\n\t\t\u003c/ProcessCreate\u003e\n\t\u003c/RuleGroup\u003e\n\t\u003c!--SYSMON EVENT ID 2 : FILE CREATION TIME RETROACTIVELY CHANGED IN THE FILESYSTEM [FileCreateTime]--\u003e\n\t\t\u003c!--COMMENT:\t[ https://attack.mitre.org/wiki/Technique/T1099 ] --\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime, PreviousCreationUtcTime--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cFileCreateTime onmatch=\"include\"\u003e\n\t\t\t\u003cImage name=\"T1099\" condition=\"begin with\"\u003eC:\\Users\u003c/Image\u003e \u003c!--Look for timestomping in user area, usually nothing should be doing that here--\u003e\n\t\t\t\u003cTargetFilename name=\"T1099\" condition=\"end with\"\u003e.exe\u003c/TargetFilename\u003e \u003c!--Look for backdated executables anywhere--\u003e\n\t\t\t\u003cImage name=\"T1099\" condition=\"begin with\"\u003e\\Device\\HarddiskVolumeShadowCopy\u003c/Image\u003e \u003c!--Nothing should be written here | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1133030955407630336 ] --\u003e\n\t\t\u003c/FileCreateTime\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cFileCreateTime onmatch=\"exclude\"\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eOneDrive.exe\u003c/Image\u003e \u003c!--OneDrive constantly changes file times--\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eC:\\Windows\\system32\\backgroundTaskHost.exe\u003c/Image\u003e\n\t\t\t\u003cImage condition=\"contains\"\u003esetup\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cImage condition=\"contains\"\u003einstall\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cImage condition=\"contains\"\u003eUpdate\\\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cImage condition=\"end with\"\u003eredist.exe\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003emsiexec.exe\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eTrustedInstaller.exe\u003c/Image\u003e \u003c!--Ignore setups--\u003e\n\t\t\t\u003cTargetFilename condition=\"contains\"\u003e\\NVIDIA\\NvBackend\\ApplicationOntology\\\u003c/TargetFilename\u003e \u003c!--NVIDIA GeForce Experience Application Ontology, 1000's of events in user profile--\u003e\n\t\t\u003c/FileCreateTime\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 3 : NETWORK CONNECTION INITIATED [NetworkConnect]--\u003e\n\t\t\u003c!--COMMENT:\tBy default this configuration takes a very conservative approach to network logging, limited to only extremely high-signal events.--\u003e\n\t\t\u003c!--COMMENT:\t[ https://attack.mitre.org/wiki/Command_and_Control ] [ https://attack.mitre.org/wiki/Exfiltration ] [ https://attack.mitre.org/wiki/Lateral_Movement ] --\u003e\n\t\t\u003c!--TECHNICAL:\tFor the DestinationHostname, Sysmon uses the GetNameInfo API, which will often not have any information, and may just be a CDN. This is NOT reliable for filtering.--\u003e\n\t\t\u003c!--TECHNICAL:\tFor the DestinationPortName, Sysmon uses the GetNameInfo API for the friendly name of ports you see in logs.--\u003e\n\t\t\u003c!--TECHNICAL:\tThese exe do not initiate their connections, and thus includes do not work in this section: BITSADMIN NLTEST--\u003e\n\t\t\n\t\t\u003c!-- https://www.first.org/resources/papers/conf2017/APT-Log-Analysis-Tracking-Attack-Tools-by-Audit-Policy-and-Sysmon.pdf --\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, User, Protocol, Initiated, SourceIsIpv6, SourceIp, SourceHostname, SourcePort, SourcePortName, DestinationIsIpV6, DestinationIp, DestinationHostname, DestinationPort, DestinationPortName--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cNetworkConnect onmatch=\"include\"\u003e\n\t\t\t\u003c!--Suspicious sources for network-connecting binaries--\u003e\n\t\t\t\u003cImage name=\"Usermode\" condition=\"begin with\"\u003eC:\\Users\u003c/Image\u003e \u003c!--Tools downloaded by users can use other processes for networking, but this is a very valuable indicator.--\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003eC:\\Recycle\u003c/Image\u003e \u003c!--Nothing should operate from the RecycleBin locations.--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\ProgramData\u003c/Image\u003e \u003c!--Normally, network communications should be sourced from \"Program Files\" not from ProgramData, something to look at--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\Windows\\Temp\u003c/Image\u003e \u003c!--Suspicious anything would communicate from the system-level temp directory--\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003e\\\u003c/Image\u003e \u003c!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] --\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003eC:\\perflogs\u003c/Image\u003e \u003c!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] --\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003eC:\\intel\u003c/Image\u003e \u003c!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] --\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003eC:\\Windows\\fonts\u003c/Image\u003e \u003c!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] --\u003e\n\t\t\t\u003cImage name=\"Caution\" condition=\"begin with\"\u003eC:\\Windows\\system32\\config\u003c/Image\u003e \u003c!-- Credit @blu3_team [ https://blu3-team.blogspot.com/2019/05/netconn-from-suspicious-directories.html ] --\u003e\n\t\t\t\u003c!--Suspicious Windows tools--\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eat.exe\u003c/Image\u003e \u003c!--Windows: Remote task scheduling, removed in Win10 | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ecertutil.exe\u003c/Image\u003e \u003c!--Windows: Certificate tool can contact outbound | Credit @ion-storm @FVT [ https://twitter.com/FVT/status/834433734602530817 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ecmd.exe\u003c/Image\u003e \u003c!--Windows: Remote command prompt--\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ecmstp.exe\u003c/Image\u003e \u003c!--Windows: Connection manager profiles can launch executables from WebDAV [ https://twitter.com/NickTyrer/status/958450014111633408 ] | Credit @NickTyrer @Oddvarmoe @KyleHanslovan @subTee --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ecscript.exe\u003c/Image\u003e \u003c!--WindowsScriptingHost: | Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003edriverquery.exe\u003c/Image\u003e \u003c!--Windows: Remote recognisance of system configuration, oudated/vulnerable drivers --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003edsquery.exe\u003c/Image\u003e \u003c!--Microsoft: Query Active Directory --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ehh.exe\u003c/Image\u003e \u003c!--Windows: HTML Help Executable, opens CHM files --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003einfDefaultInstall.exe\u003c/Image\u003e \u003c!--Microsoft: [ https://github.com/huntresslabs/evading-autoruns ] | Credit @KyleHanslovan --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ejava.exe\u003c/Image\u003e \u003c!--Java: Monitor usage of vulnerable application and init from JAR files | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ejavaw.exe\u003c/Image\u003e \u003c!--Java: Monitor usage of vulnerable application and init from JAR files --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ejavaws.exe\u003c/Image\u003e \u003c!--Java: Monitor usage of vulnerable application and init from JAR files --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003emmc.exe\u003c/Image\u003e \u003c!--Windows: --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003emsbuild.exe\u003c/Image\u003e \u003c!--Windows: [ https://www.hybrid-analysis.com/sample/a314f6106633fba4b70f9d6ddbee452e8f8f44a72117749c21243dc93c7ed3ac?environmentId=100 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003emshta.exe\u003c/Image\u003e \u003c!--Windows: HTML application executes scripts without IE protections | Credit @ion-storm [ https://en.wikipedia.org/wiki/HTML_Application ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003emsiexec.exe\u003c/Image\u003e \u003c!--Windows: Can install from http:// paths | Credit @vector-sec --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enbtstat.exe\u003c/Image\u003e \u003c!--Windows: NetBIOS statistics, attackers use to enumerate local network --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enet.exe\u003c/Image\u003e \u003c!--Windows: Note - May not detect anything, net.exe is a front-end to lower APIs | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enet1.exe\u003c/Image\u003e \u003c!--Windows: Launched by \"net.exe\", but it may not detect connections either --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enotepad.exe\u003c/Image\u003e \u003c!--Windows: [ https://secrary.com/ReversingMalware/CoinMiner/ ] [ https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enslookup.exe\u003c/Image\u003e \u003c!--Windows: Retrieve data over DNS --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003epowershell.exe\u003c/Image\u003e \u003c!--Windows: PowerShell interface--\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eqprocess.exe\u003c/Image\u003e \u003c!--Windows: [ https://www.first.org/resources/papers/conf2017/APT-Log-Analysis-Tracking-Attack-Tools-by-Audit-Policy-and-Sysmon.pdf ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eqwinsta.exe\u003c/Image\u003e \u003c!--Windows: Query remote sessions | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eqwinsta.exe\u003c/Image\u003e \u003c!--Windows: Remotely query login sessions on a server or workstation | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ereg.exe\u003c/Image\u003e \u003c!--Windows: Remote Registry editing ability | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eregsvcs.exe\u003c/Image\u003e \u003c!--Windows: [ https://www.hybrid-analysis.com/sample/3f94d7080e6c5b8f59eeecc3d44f7e817b31562caeba21d02ad705a0bfc63d67?environmentId=100 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eregsvr32.exe\u003c/Image\u003e \u003c!--Windows: [ https://subt0x10.blogspot.com/2016/04/bypass-application-whitelisting-script.html ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003erundll32.exe\u003c/Image\u003e \u003c!--Windows: [ https://blog.cobaltstrike.com/2016/07/22/why-is-rundll32-exe-connecting-to-the-internet/ ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003erwinsta.exe\u003c/Image\u003e \u003c!--Windows: Disconnect remote sessions | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003esc.exe\u003c/Image\u003e \u003c!--Windows: Remotely change Windows service settings | Credit @ion-storm --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003eschtasks.exe\u003c/Image\u003e \u003c!--Windows: Command-line interface to local and remote tasks --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003etaskkill.exe\u003c/Image\u003e \u003c!--Windows: Kill processes, has remote ability --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003etasklist.exe\u003c/Image\u003e \u003c!--Windows: List processes, has remote ability --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ewmic.exe\u003c/Image\u003e \u003c!--WindowsManagementInstrumentation: Credit @Cyb3rOps [ https://gist.github.com/Neo23x0/a4b4af9481e01e749409 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ewscript.exe\u003c/Image\u003e \u003c!--WindowsScriptingHost: | Credit @arekfurt --\u003e\n\t\t\t\u003c!--Relevant 3rd Party Tools--\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enc.exe\u003c/Image\u003e \u003c!-- Nmap's modern version of netcat [ https://nmap.org/ncat/guide/index.html#ncat-overview ] [ https://securityblog.gr/1517/create-backdoor-in-windows-with-ncat/ ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003encat.exe\u003c/Image\u003e \u003c!-- Nmap's modern version of netcat [ https://nmap.org/ncat/guide/index.html#ncat-overview ] [ https://securityblog.gr/1517/create-backdoor-in-windows-with-ncat/ ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003epsexec.exe\u003c/Image\u003e \u003c!--Sysinternals:PsExec client side | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003epsexesvc.exe\u003c/Image\u003e \u003c!--Sysinternals:PsExec server side | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003etor.exe\u003c/Image\u003e \u003c!--Tor [ https://www.hybrid-analysis.com/sample/800bf028a23440134fc834efc5c1e02cc70f05b2e800bbc285d7c92a4b126b1c?environmentId=100 ] --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003evnc.exe\u003c/Image\u003e \u003c!-- VNC client | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003evncservice.exe\u003c/Image\u003e \u003c!-- VNC server | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003evncviewer.exe\u003c/Image\u003e \u003c!-- VNC client | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003ewinexesvc.exe\u003c/Image\u003e \u003c!-- Winexe service executable | Credit @Cyb3rOps --\u003e\n\t\t\t\u003cImage condition=\"image\"\u003enmap.exe\u003c/Image\u003e\n\t\t\t\u003cImage condition=\"image\"\u003epsinfo.exe\u003c/Image\u003e\n\t\t\t\u003c!--Ports: Suspicious--\u003e\n\t\t\t\u003cDestinationPort name=\"SSH\" condition=\"is\"\u003e22\u003c/DestinationPort\u003e \u003c!--SSH protocol, monitor admin connections--\u003e\n\t\t\t\u003cDestinationPort name=\"Telnet\" condition=\"is\"\u003e23\u003c/DestinationPort\u003e \u003c!--Telnet protocol, monitor admin connections, insecure--\u003e\n\t\t\t\u003cDestinationPort name=\"SMTP\" condition=\"is\"\u003e25\u003c/DestinationPort\u003e \u003c!--SMTP mail protocol port, insecure, used by threats--\u003e\n\t\t\t\u003cDestinationPort name=\"IMAP\" condition=\"is\"\u003e143\u003c/DestinationPort\u003e \u003c!--IMAP mail protocol port, insecure, used by threats--\u003e\n\t\t\t\u003cDestinationPort name=\"RDP\" condition=\"is\"\u003e3389\u003c/DestinationPort\u003e \u003c!--Windows:RDP: Monitor admin connections--\u003e\n\t\t\t\u003cDestinationPort name=\"VNC\" condition=\"is\"\u003e5800\u003c/DestinationPort\u003e \u003c!--VNC protocol: Monitor admin connections, often insecure, using hard-coded admin password--\u003e\n\t\t\t\u003cDestinationPort name=\"VNC\" condition=\"is\"\u003e5900\u003c/DestinationPort\u003e \u003c!--VNC protocol Monitor admin connections, often insecure, using hard-coded admin password--\u003e\n\t\t\t\u003cDestinationPort name=\"Alert,Metasploit\" condition=\"is\"\u003e444\u003c/DestinationPort\u003e\n\t\t\t\u003c!--Ports: Proxy--\u003e\n\t\t\t\u003cDestinationPort name=\"Proxy\" condition=\"is\"\u003e1080\u003c/DestinationPort\u003e \u003c!--Socks proxy port | Credit @ion-storm--\u003e\n\t\t\t\u003cDestinationPort name=\"Proxy\" condition=\"is\"\u003e3128\u003c/DestinationPort\u003e \u003c!--Socks proxy port | Credit @ion-storm--\u003e\n\t\t\t\u003cDestinationPort name=\"Proxy\" condition=\"is\"\u003e8080\u003c/DestinationPort\u003e \u003c!--Socks proxy port | Credit @ion-storm--\u003e\n\t\t\t\u003c!--Ports: Tor--\u003e\n\t\t\t\u003cDestinationPort name=\"Tor\" condition=\"is\"\u003e1723\u003c/DestinationPort\u003e \u003c!--Tor protocol [ https://attack.mitre.org/wiki/Technique/T1090 ] | Credit @ion-storm--\u003e\n\t\t\t\u003cDestinationPort name=\"Tor\" condition=\"is\"\u003e9001\u003c/DestinationPort\u003e \u003c!--Tor protocol [ http://www.computerworlduk.com/tutorial/security/tor-enterprise-2016-blocking-malware-darknet-use-rogue-nodes-3633907/ ] --\u003e\n\t\t\t\u003cDestinationPort name=\"Tor\" condition=\"is\"\u003e9030\u003c/DestinationPort\u003e \u003c!--Tor protocol [ http://www.computerworlduk.com/tutorial/security/tor-enterprise-2016-blocking-malware-darknet-use-rogue-nodes-3633907/ ] --\u003e\n\t\t\u003c/NetworkConnect\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cNetworkConnect onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--SECTION: Microsoft--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\\u003c/Image\u003e\n\t\t\t\u003cImage condition=\"end with\"\u003eAppData\\Local\\Microsoft\\Teams\\current\\Teams.exe\u003c/Image\u003e \u003c!--Microsoft: Teams--\u003e\n\t\t\t\u003cDestinationHostname condition=\"end with\"\u003e.microsoft.com\u003c/DestinationHostname\u003e \u003c!--Microsoft:Update delivery--\u003e\n\t\t\t\u003cDestinationHostname condition=\"end with\"\u003emicrosoft.com.akadns.net\u003c/DestinationHostname\u003e \u003c!--Microsoft:Update delivery--\u003e\n\t\t\t\u003cDestinationHostname condition=\"end with\"\u003emicrosoft.com.nsatc.net\u003c/DestinationHostname\u003e \u003c!--Microsoft:Update delivery--\u003e\n\t\t\t\u003c!--Section: Loopback Addresses--\u003e\n\t\t\t\u003cDestinationIp condition=\"is\"\u003e127.0.0.1\u003c/DestinationIp\u003e \u003c!--Credit @ITProPaul--\u003e\n\t\t\t\u003cDestinationIp condition=\"begin with\"\u003efe80:0:0:0\u003c/DestinationIp\u003e \u003c!--Credit @ITProPaul--\u003e\n\t\t\u003c/NetworkConnect\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 4 : RESERVED FOR SYSMON SERVICE STATUS MESSAGES--\u003e\n\n\t\t\u003c!--DATA: UtcTime, State, Version, SchemaVersion--\u003e\n\t\t\u003c!--Cannot be filtered.--\u003e\n\n\t\u003c!--SYSMON EVENT ID 5 : PROCESS ENDED [ProcessTerminate]--\u003e\n\t\t\u003c!--COMMENT:\tUseful data in building infection timelines.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cProcessTerminate onmatch=\"include\"\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\Users\u003c/Image\u003e \u003c!--Process terminations by user binaries--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003e\\\u003c/Image\u003e \u003c!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] --\u003e\n\t\t\u003c/ProcessTerminate\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cProcessTerminate onmatch=\"exclude\"\u003e\n\t\t\u003c/ProcessTerminate\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 6 : DRIVER LOADED INTO KERNEL [DriverLoad]--\u003e\n\t\t\u003c!--COMMENT:\tBecause drivers with bugs can be used to escalate to kernel permissions, be extremely selective\n\t\t\tabout what you exclude from monitoring. Low event volume, little incentive to exclude.\n\t\t\t[ https://attack.mitre.org/wiki/Technique/T1014 ] --\u003e\n\t\t\u003c!--TECHNICAL:\tSysmon will check the signing certificate revocation status of any driver you don't exclude.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, ImageLoaded, Hashes, Signed, Signature, SignatureStatus--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cDriverLoad onmatch=\"exclude\"\u003e\n\t\t\t\u003cSignature condition=\"contains\"\u003emicrosoft\u003c/Signature\u003e \u003c!--Exclude signed Microsoft drivers--\u003e\n\t\t\t\u003cSignature condition=\"contains\"\u003ewindows\u003c/Signature\u003e \u003c!--Exclude signed Microsoft drivers--\u003e\n\t\t\t\u003cSignature condition=\"begin with\"\u003eIntel \u003c/Signature\u003e \u003c!--Exclude signed Intel drivers--\u003e\n\t\t\u003c/DriverLoad\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 7 : DLL (IMAGE) LOADED BY PROCESS [ImageLoad]--\u003e\n\t\t\u003c!--COMMENT:\tCan cause high system load, disabled by default.--\u003e\n\t\t\u003c!--COMMENT:\t[ https://attack.mitre.org/wiki/Technique/T1073 ] [ https://attack.mitre.org/wiki/Technique/T1038 ] [ https://attack.mitre.org/wiki/Technique/T1034 ] --\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, ImageLoaded, Hashes, Signed, Signature, SignatureStatus--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cImageLoad onmatch=\"include\"\u003e\n\t\t\t\u003cRule name=\"\" groupRelation=\"and\"\u003e\n\t\t\t\t\u003cImageLoaded condition=\"end with\"\u003e.dll\u003c/ImageLoaded\u003e\n\t\t\t\t\u003cSignatureStatus condition=\"is not\"\u003eValid\u003c/SignatureStatus\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule name=\"\" groupRelation=\"and\"\u003e\n\t\t\t\t\u003cImageLoaded condition=\"end with\"\u003e.ocx\u003c/ImageLoaded\u003e\n\t\t\t\t\u003cSignatureStatus condition=\"is not\"\u003eValid\u003c/SignatureStatus\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule name=\"\" groupRelation=\"and\"\u003e\n\t\t\t\t\u003cImage condition=\"excludes\"\u003e\\windows\\system32\\\u003c/Image\u003e\n\t\t\t\t\u003cImage condition=\"excludes\"\u003e\\windows\\syswow64\\\u003c/Image\u003e\n\t\t\t\t\u003cImageLoaded condition=\"end with\"\u003e.exe\u003c/ImageLoaded\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\u003c/ImageLoad\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 8 : REMOTE THREAD CREATED [CreateRemoteThread]--\u003e\n\t\t\u003c!--COMMENT:\tMonitor for processes injecting code into other processes. Often used by malware to cloak their actions. Also when Firefox loads Flash.\n\t\t[ https://attack.mitre.org/wiki/Technique/T1055 ] --\u003e\n\n\t\t\u003c!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceImage, TargetProcessId, TargetImage, NewThreadId, StartAddress, StartModule, StartFunction--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cCreateRemoteThread onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--COMMENT: Exclude mostly-safe sources and log anything else.--\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\wbem\\WmiPrvSE.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\svchost.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\wininit.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\csrss.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\services.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\winlogon.exe\u003c/SourceImage\u003e\n\t\t\t\u003cSourceImage condition=\"is\"\u003eC:\\Windows\\system32\\audiodg.exe\u003c/SourceImage\u003e\n\t\t\t\u003cStartModule condition=\"is\"\u003eC:\\Windows\\system32\\kernel32.dll\u003c/StartModule\u003e\n\t\t\t\u003cTargetImage condition=\"is\"\u003eC:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\u003c/TargetImage\u003e\n\t\t\u003c/CreateRemoteThread\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 9 : RAW DISK ACCESS [RawAccessRead]--\u003e\n\t\t\u003c!--EVENT 9: \"RawAccessRead detected\"--\u003e\n\t\t\u003c!--COMMENT:\tCan cause high system load, disabled by default.--\u003e\n\t\t\u003c!--COMMENT:\tMonitor for raw sector-level access to the disk, often used to bypass access control lists or access locked files.\n\t\t\tDisabled by default since including even one entry here activates this component. Reward/performance/rule maintenance decision.\n\t\t\tEncourage you to experiment with this feature yourself. [ https://attack.mitre.org/wiki/Technique/T1067 ] --\u003e\n\t\t\u003c!--COMMENT:\tYou will likely want to set this to a full capture on domain controllers, where no process should be doing raw reads.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, Device--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cRawAccessRead onmatch=\"include\"\u003e\n\t\t\t\u003c!--NOTE: Using \"include\" with no rules means nothing in this section will be logged--\u003e\n\t\t\u003c/RawAccessRead\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 10 : INTER-PROCESS ACCESS [ProcessAccess]--\u003e\n\t\t\u003c!--EVENT 10: \"Process accessed\"--\u003e\n\t\t\u003c!--COMMENT:\tCan cause high system load, disabled by default.--\u003e\n\t\t\u003c!--COMMENT:\tMonitor for processes accessing other process' memory.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, SourceProcessGuid, SourceProcessId, SourceThreadId, SourceImage, TargetProcessGuid, TargetProcessId, TargetImage, GrantedAccess, CallTrace--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cProcessAccess onmatch=\"include\"\u003e\n\t\t\t\u003c!-- In some environments this causes HIGH CPU usage by sysmon, remove this module when that occurs --\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1FFFFF\u003c/GrantedAccess\u003e          \u003c!--Expect EDRs/AVs to also trigger this--\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1F1FFF\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1010\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x143A\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1F2FFF\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1F3FFF\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1F0FFF\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1418\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1438\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1410\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003cTargetImage name=\"technique_id=T1003,technique_name=Credential Dumping\" condition=\"is\"\u003eC:\\Windows\\system32\\lsass.exe\u003c/TargetImage\u003e          \u003c!--Mitre T1098--\u003e          \u003c!--Mitre T1550.002--\u003e          \u003c!--Mitre T1003--\u003e          \u003c!-- depending on what you're running on your host, this might be noisy--\u003e\n\t\t\t\t\u003cGrantedAccess\u003e0x1FFF\u003c/GrantedAccess\u003e\n\t\t\t\u003c/Rule\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n            \u003c/Rule\u003e\n\t\t\t\u003c!--Mitre T1055 --\u003e\n\t\t\t\u003cRule groupRelation=\"and\"\u003e\n\t\t\t\t\u003c!-- Copy of CreateRemoteThread (event 8) whitelist --\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\wbem\\WmiPrvSE.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\svchost.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\wininit.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\csrss.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\services.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\winlogon.exe\u003c/SourceImage\u003e\n                \u003cSourceImage condition=\"is not\"\u003eC:\\Windows\\system32\\audiodg.exe\u003c/SourceImage\u003e\n                \u003cGrantedAccess condition=\"is any\"\u003e0x1F0FFF;0x1F1FFF;0x1F2FFF;0x1F3FFF;0x1FFFFF\u003c/GrantedAccess\u003e\n            \u003c/Rule\u003e\n\t\t\u003c/ProcessAccess\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 11 : FILE CREATED [FileCreate]--\u003e\n\t\t\u003c!--EVENT 11: \"File created\"--\u003e\n\t\t\u003c!--NOTE:\tOther filesystem \"minifilters\" can make it appear to Sysmon that some files are being written twice. This is not a Sysmon issue, per Mark Russinovich.--\u003e\n\t\t\u003c!--NOTE:\tYou may not see files detected by antivirus. Other filesystem minifilters, like antivirus, can act before Sysmon receives the alert a file was written.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cFileCreate onmatch=\"include\"\u003e\n\t\t\t\u003cTargetFilename name=\"T1023\" condition=\"contains\"\u003e\\Start Menu\u003c/TargetFilename\u003e \u003c!--Windows: Startup links and shortcut modification [ https://attack.mitre.org/wiki/Technique/T1023 ] --\u003e\n\t\t\t\u003cTargetFilename name=\"T1165\" condition=\"contains\"\u003e\\Startup\\\u003c/TargetFilename\u003e \u003c!--Microsoft:Changes to user's auto-launched files and shortcuts--\u003e\n\t\t\t\u003cTargetFilename name=\"OutlookAttachment\" condition=\"contains\"\u003e\\Content.Outlook\\\u003c/TargetFilename\u003e \u003c!--Microsoft:Outlook: attachments--\u003e\n\t\t\t\u003cTargetFilename name=\"Downloads\" condition=\"contains\"\u003e\\Downloads\\\u003c/TargetFilename\u003e \u003c!--Downloaded files. Does not include \"Run\" files in IE--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.application\u003c/TargetFilename\u003e \u003c!--Microsoft:ClickOnce: [ https://blog.netspi.com/all-you-need-is-one-a-clickonce-love-story/ ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.appref-ms\u003c/TargetFilename\u003e \u003c!--Microsoft:ClickOnce application | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.bat\u003c/TargetFilename\u003e \u003c!--Batch scripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.chm\u003c/TargetFilename\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.cmd\u003c/TargetFilename\u003e \u003c!--Batch scripting: Batch scripts can also use the .cmd extension | Credit: @mmazanec --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.cmdline\u003c/TargetFilename\u003e \u003c!--Microsoft:dotNet: Executed by cvtres.exe--\u003e\n\t\t\t\u003cTargetFilename name=\"T1176\" condition=\"end with\"\u003e.crx\u003c/TargetFilename\u003e \u003c!--Chrome extension--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.dmp\u003c/TargetFilename\u003e \u003c!--Process dumps [ (fr) http://blog.gentilkiwi.com/securite/mimikatz/minidump ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.docm\u003c/TargetFilename\u003e \u003c!--Microsoft:Office:Word: Macro--\u003e\n\t\t\t\u003cTargetFilename name=\"DLL\" condition=\"end with\"\u003e.dll\u003c/TargetFilename\u003e \u003c!--Microsoft:Office:Word: Macro--\u003e\n\t\t\t\u003cTargetFilename name=\"EXE\" condition=\"end with\"\u003e.exe\u003c/TargetFilename\u003e \u003c!--Executable--\u003e\n\t\t\t\u003cTargetFilename name=\"ProcessHostingdotNETCode\" condition=\"end with\"\u003e.exe.log\u003c/TargetFilename\u003e \u003c!-- [ https://github.com/bitsadmin/nopowershell ] | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1137493597769687040 ]  --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.jar\u003c/TargetFilename\u003e \u003c!--Java applets--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.jnlp\u003c/TargetFilename\u003e \u003c!--Java applets--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.jse\u003c/TargetFilename\u003e \u003c!--Scripting [ Example: https://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/Mal~Phires-C/detailed-analysis.aspx ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.hta\u003c/TargetFilename\u003e \u003c!--Scripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.job\u003c/TargetFilename\u003e \u003c!--Scheduled task--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.pptm\u003c/TargetFilename\u003e \u003c!--Microsoft:Office:Word: Macro--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.ps1\u003c/TargetFilename\u003e \u003c!--PowerShell [ More information: http://www.hexacorn.com/blog/2014/08/27/beyond-good-ol-run-key-part-16/ ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.sys\u003c/TargetFilename\u003e \u003c!--System driver files--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.scr\u003c/TargetFilename\u003e \u003c!--System driver files--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.vbe\u003c/TargetFilename\u003e \u003c!--VisualBasicScripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.vbs\u003c/TargetFilename\u003e \u003c!--VisualBasicScripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.xlsm\u003c/TargetFilename\u003e \u003c!--Microsoft:Office:Word: Macro--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003eproj\u003c/TargetFilename\u003e\u003c!--Microsoft:MSBuild:Script: More information: https://twitter.com/subTee/status/885919612969394177--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.sln\u003c/TargetFilename\u003e\u003c!--Microsoft:MSBuild:Script: More information: https://twitter.com/subTee/status/885919612969394177--\u003e\n\t\t\t\u003cTargetFilename name=\"DefaultUserModified\" condition=\"begin with\"\u003eC:\\Users\\Default\u003c/TargetFilename\u003e \u003c!--Windows: Changes to default user profile--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\system32\\Drivers\u003c/TargetFilename\u003e \u003c!--Microsoft: Drivers dropped here--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\SysWOW64\\Drivers\u003c/TargetFilename\u003e \u003c!--Microsoft: Drivers dropped here--\u003e\n\t\t\t\u003cTargetFilename name=\"T1037,T1484\" condition=\"begin with\"\u003eC:\\Windows\\system32\\GroupPolicy\\Machine\\Scripts\u003c/TargetFilename\u003e \u003c!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] --\u003e\n\t\t\t\u003cTargetFilename name=\"T1037,T1484\" condition=\"begin with\"\u003eC:\\Windows\\system32\\GroupPolicy\\User\\Scripts\u003c/TargetFilename\u003e \u003c!--Group policy [ More information: http://www.hexacorn.com/blog/2017/01/07/beyond-good-ol-run-key-part-52/ ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\system32\\Wbem\u003c/TargetFilename\u003e \u003c!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\SysWOW64\\Wbem\u003c/TargetFilename\u003e \u003c!--Microsoft:WMI: [ More information: http://2014.hackitoergosum.org/slides/day1_WMI_Shell_Andrei_Dumitrescu.pdf ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\system32\\WindowsPowerShell\u003c/TargetFilename\u003e \u003c!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\SysWOW64\\WindowsPowerShell\u003c/TargetFilename\u003e \u003c!--Microsoft:Powershell: Look for modifications for persistence [ https://www.malwarearchaeology.com/cheat-sheets ] --\u003e\n\t\t\t\u003cTargetFilename name=\"T1053\" condition=\"begin with\"\u003eC:\\Windows\\Tasks\\\u003c/TargetFilename\u003e \u003c!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] --\u003e\n\t\t\t\u003cTargetFilename name=\"T1053\" condition=\"begin with\"\u003eC:\\Windows\\system32\\Tasks\u003c/TargetFilename\u003e \u003c!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] --\u003e\n\t\t\t\u003cTargetFilename name=\"T1053\" condition=\"begin with\"\u003eC:\\Windows\\SysWOW64\\Tasks\u003c/TargetFilename\u003e \u003c!--Microsoft:ScheduledTasks [ https://attack.mitre.org/wiki/Technique/T1053 ] --\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003e\\Device\\HarddiskVolumeShadowCopy\u003c/Image\u003e \u003c!--Nothing should be executing from VSC | Credit: @SBousseaden [ https://twitter.com/SBousseaden/status/1133030955407630336 ] --\u003e\n\t\t\t\u003c!--Windows application compatibility--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\AppPatch\\Custom\u003c/TargetFilename\u003e \u003c!--Windows: Application compatibility shims [ https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"contains\"\u003eVirtualStore\u003c/TargetFilename\u003e \u003c!--Windows: UAC virtualization [ https://blogs.msdn.microsoft.com/oldnewthing/20150902-00/?p=91681 ] --\u003e\n\t\t\t\u003c!--Exploitable file names--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.xls\u003c/TargetFilename\u003e \u003c!--Legacy Office files are often used for attacks--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.ppt\u003c/TargetFilename\u003e \u003c!--Legacy Office files are often used for attacks--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.rtf\u003c/TargetFilename\u003e \u003c!--RTF files often 0day malware vectors when opened by Office--\u003e\n      \u003cTargetFilename condition=\"end with\"\u003e.inf\u003c/TargetFilename\u003e\n      \u003cTargetFilename condition=\"end with\"\u003e.lnk\u003c/TargetFilename\u003e\n\t\t\u003c/FileCreate\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cFileCreate onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--SECTION: Microsoft--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files (x86)\\EMET 5.5\\EMET_Service.exe\u003c/Image\u003e \u003c!--Microsoft:EMET: Writes to C:\\Windows\\AppPatch\\--\u003e\n\t\t\t\u003c!--SECTION: Microsoft:Office:Click2Run--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeC2RClient.exe\u003c/Image\u003e \u003c!-- Microsoft:Office Click2Run--\u003e\n\t\t\t\u003c!--SECTION: Windows--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\smss.exe\u003c/Image\u003e \u003c!-- Windows: Session Manager SubSystem: Creates swapfile.sys,pagefile.sys,hiberfile.sys--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\CompatTelRunner.exe\u003c/Image\u003e \u003c!-- Windows: Windows 10 app, creates tons of cache files--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003e\\\\?\\C:\\Windows\\system32\\wbem\\WMIADAP.EXE\u003c/Image\u003e \u003c!-- Windows: WMI Performance updates--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Windows\\system32\\mobsync.exe\u003c/Image\u003e \u003c!--Windows: Network file syncing--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\system32\\DriverStore\\Temp\\\u003c/TargetFilename\u003e \u003c!-- Windows: Temp files by DrvInst.exe--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\system32\\wbem\\Performance\\\u003c/TargetFilename\u003e \u003c!-- Windows: Created in wbem by WMIADAP.exe--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\Windows\\Installer\\\u003c/TargetFilename\u003e \u003c!--Windows:Installer: Ignore MSI installer files caching--\u003e\n\t\t\t\u003c!--SECTION: Windows:Updates--\u003e\n\t\t\t\u003cTargetFilename condition=\"begin with\"\u003eC:\\$WINDOWS.~BT\\Sources\\\u003c/TargetFilename\u003e \u003c!-- Windows: Feature updates containing lots of .exe and .sys--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\Windows\\winsxs\\amd64_microsoft-windows\u003c/Image\u003e \u003c!-- Windows: Windows update--\u003e\n\t\t\u003c/FileCreate\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 12 \u0026 13 \u0026 14 : REGISTRY MODIFICATION [RegistryEvent]--\u003e\n\t\t\u003c!--EVENT 12: \"Registry object added or deleted\"--\u003e\n\t\t\u003c!--EVENT 13: \"Registry value set\"--\u003e\n\t\t\u003c!--EVENT 14: \"Registry objected renamed\"--\u003e\n\n\t\t\u003c!--NOTE:\tWindows writes hundreds or thousands of registry keys a minute, so just because you're not changing things, doesn't mean these rules aren't being run.--\u003e\n\t\t\u003c!--NOTE:\tYou do not have to spend a lot of time worrying about performance, CPUs are fast, but it's something to consider. Every rule and condition type has a small cost.--\u003e\n\t\t\u003c!--NOTE:\t\"contains\" works by finding the first letter, then matching the second, etc, so the first letters should be as low-occurrence as possible.--\u003e\n\t\t\u003c!--NOTE:\t[ https://attack.mitre.org/wiki/Technique/T1112 ] --\u003e\n\n\t\t\u003c!--TECHNICAL:\tYou cannot filter on the \"Details\" attribute, due to performance issues when very large keys are written, and variety of data formats--\u003e\n\t\t\u003c!--TECHNICAL:\tPossible prefixes are HKLM, HKCR, and HKU--\u003e\n\t\t\u003c!--CRITICAL:\tSchema version 3.30 and higher change HKLM\\=\"\\REGISTRY\\MACHINE\\\" and HKU\\=\"\\REGISTRY\\USER\\\" and HKCR\\=\"\\REGISTRY\\MACHINE\\SOFTWARE\\Classes\\\" and CurrentControlSet=\"ControlSet001\"--\u003e\n\t\t\u003c!--CRITICAL:\tDue to a bug, Sysmon versions BEFORE 7.01 may not properly log with the new prefix style for registry keys that was originally introduced in schema version 3.30--\u003e\n\t\t\u003c!--NOTE:\tBecause Sysmon runs as a service, it has no filtering ability for, or concept of, HKCU or HKEY_CURRENT_USER. Use \"contains\" or \"end with\" to get around this limitation--\u003e\n\n\t\t\u003c!-- ! CRITICAL NOTE !:\tIt may appear this section is MISSING important entries, but SOME RULES MONITOR MANY KEYS, so look VERY CAREFULLY to see if something is already covered.\n\t\t\t\t\t\t\t\tSysmon's wildcard monitoring along with highly-tuned generic strings cuts the rulesets down immensely, compared to doing this in other tools.\n\t\t\t\t\t\t\t\tFor example, most COM hijacking in CLSID's across the registry is covered by a single rule monitoring a InProcServer32 wildcard--\u003e\n\n\t\t\u003c!--DATA: EventType, UtcTime, ProcessGuid, ProcessId, Image, TargetObject, Details (can't filter on), NewName (can't filter on)--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cRegistryEvent onmatch=\"include\"\u003e\n\t\t\t\u003c!--Autorun or Startups--\u003e\n\t\t\t\t\u003c!--ADDITIONAL REFERENCE: [ http://www.ghacks.net/2016/06/04/windows-automatic-startup-locations/ ] --\u003e\n\t\t\t\t\u003c!--ADDITIONAL REFERENCE: [ https://view.officeapps.live.com/op/view.aspx?src=https://arsenalrecon.com/downloads/resources/Registry_Keys_Related_to_Autorun.ods ] --\u003e\n\t\t\t\t\u003c!--ADDITIONAL REFERENCE: [ http://www.silentrunners.org/launchpoints.html ] --\u003e\n\t\t\t\t\u003c!--ADDITIONAL REFERENCE: [ https://www.microsoftpressstore.com/articles/article.aspx?p=2762082\u0026seqNum=2 ] --\u003e\n\t\t\t\t\u003c!--ADDITIONAL REFERENCE: [ https://web.archive.org/web/20200116001643/http://scholarworks.rit.edu/cgi/viewcontent.cgi?article=1533\u0026context=theses | Understanding malware autostart techniques - Matthew Gottlieb ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1060,RunKey\" condition=\"contains\"\u003eCurrentVersion\\Run\u003c/TargetObject\u003e \u003c!--Windows: Wildcard for Run keys, including RunOnce, RunOnceEx, RunServices, RunServicesOnce [Also covers terminal server] --\u003e\n\t\t\t\u003cTargetObject name=\"T1060,RunPolicy\" condition=\"contains\"\u003ePolicies\\Explorer\\Run\u003c/TargetObject\u003e \u003c!--Windows: Alternate runs keys | Credit @ion-storm--\u003e\n\t\t\t\u003cTargetObject name=\"T1484\" condition=\"contains\"\u003eGroup Policy\\Scripts\u003c/TargetObject\u003e \u003c!--Windows: Group policy scripts--\u003e\n\t\t\t\u003cTargetObject name=\"T1484\" condition=\"contains\"\u003eWindows\\System\\Scripts\u003c/TargetObject\u003e \u003c!--Windows: Wildcard for Logon, Loggoff, Shutdown--\u003e\n\t\t\t\u003cTargetObject name=\"T1060\" condition=\"contains\"\u003eCurrentVersion\\Windows\\Load\u003c/TargetObject\u003e \u003c!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1060\" condition=\"contains\"\u003eCurrentVersion\\Windows\\Run\u003c/TargetObject\u003e \u003c!--Windows: [ https://msdn.microsoft.com/en-us/library/jj874148.aspx ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1060\" condition=\"contains\"\u003eCurrentVersion\\Winlogon\\Shell\u003c/TargetObject\u003e \u003c!--Windows: [ https://msdn.microsoft.com/en-us/library/ms838576(v=winembedded.5).aspx ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1060\" condition=\"contains\"\u003eCurrentVersion\\Winlogon\\System\u003c/TargetObject\u003e \u003c!--Windows [ https://www.exterminate-it.com/malpedia/regvals/zlob-dns-changer/118 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\u003c/TargetObject\u003e \u003c!--Windows: Autorun location [ https://attack.mitre.org/wiki/Technique/T1004 ] [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\u003c/TargetObject\u003e \u003c!--Windows: [ https://technet.microsoft.com/en-us/library/ee851671.aspx ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\u003c/TargetObject\u003e \u003c!--Windows: Autorun location [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\WOW6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Drivers32\u003c/TargetObject\u003e \u003c!--Windows: Legacy driver loading | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\BootExecute\u003c/TargetObject\u003e \u003c!--Windows: Autorun | Credit @ion-storm | [ https://www.cylance.com/windows-registry-persistence-part-2-the-run-keys-and-search-order ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug\u003c/TargetObject\u003e \u003c!--Windows: Automatic program crash debug program [ https://www.symantec.com/security_response/writeup.jsp?docid=2007-050712-5453-99\u0026tabid=2 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eUserInitMprLogonScript\u003c/TargetObject\u003e \u003c!--Windows: Legacy logon script environment variable [ http://www.hexacorn.com/blog/2014/11/14/beyond-good-ol-run-key-part-18/ ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1112,ChangeStartupFolderPath\" condition=\"end with\"\u003euser shell folders\\startup\u003c/TargetObject\u003e \u003c!--Monitor changes to Startup folder location for monitoring evasion | Credit @SBousseaden--\u003e\n\t\t\t\u003c!--Services--\u003e\n\t\t\t\u003cTargetObject name=\"LsaComponents\" condition=\"contains\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Services\\ntds\u003c/TargetObject\u003e\n\t\t\t\u003cTargetObject name=\"T1031,T1050\" condition=\"end with\"\u003e\\ServiceDll\u003c/TargetObject\u003e \u003c!--Windows: Points to a service's DLL [ https://blog.cylance.com/windows-registry-persistence-part-1-introduction-attack-phases-and-windows-services ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1031,T1050\" condition=\"end with\"\u003e\\ServiceManifest\u003c/TargetObject\u003e \u003c!--Windows: Manifest pointing to service's DLL [ https://www.geoffchappell.com/studies/windows/win32/services/svchost/index.htm ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1031,T1050\" condition=\"end with\"\u003e\\ImagePath\u003c/TargetObject\u003e \u003c!--Windows: Points to a service's EXE [ https://attack.mitre.org/wiki/Technique/T1050 ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1031,T1050\" condition=\"end with\"\u003e\\Start\u003c/TargetObject\u003e \u003c!--Windows: Services start mode changes (Disabled, Automatically, Manual)--\u003e\n\t\t\t\u003c!--RDP--\u003e\n\t\t\t\u003cTargetObject name=\"RDP port change\" condition=\"end with\"\u003eControl\\Terminal Server\\WinStations\\RDP-Tcp\\PortNumber\u003c/TargetObject\u003e \u003c!--Windows: RDP port change under Control [ https://blog.menasec.net/2019/02/of-rdp-hijacking-part1-remote-desktop.html ]--\u003e\n\t\t\t\u003cTargetObject name=\"RDP port change\" condition=\"end with\"\u003eControl\\Terminal Server\\fSingleSessionPerUser\u003c/TargetObject\u003e \u003c!--Windows: Allow same user to have mutliple RDP sessions, to hide from admin being impersonated--\u003e\n\t\t\t\u003cTargetObject name=\"ModifyRemoteDesktopState\" condition=\"end with\"\u003efDenyTSConnections\u003c/TargetObject\u003e \u003c!--Windows: Attacker turning on RDP--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eLastLoggedOnUser\u003c/TargetObject\u003e \u003c!--Windows: Changing last-logged in user--\u003e\n\t\t\t\u003cTargetObject name=\"ModifyRemoteDesktopPort\" condition=\"end with\"\u003eRDP-tcp\\PortNumber\u003c/TargetObject\u003e \u003c!--Windows: Changing RDP port to evade IDS--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eServices\\PortProxy\\v4tov4\u003c/TargetObject\u003e \u003c!--Windows: Changing RDP port to evade IDS--\u003e\n\t\t\t\u003c!--CLSID launch commands and Default File Association changes--\u003e\n\t\t\t\u003cTargetObject name=\"T1042\" condition=\"contains\"\u003e\\command\\\u003c/TargetObject\u003e \u003c!--Windows: Sensitive sub-key under file associations and CLSID that map to launch command--\u003e\n\t\t\t\u003cTargetObject name=\"T1122\" condition=\"contains\"\u003e\\ddeexec\\\u003c/TargetObject\u003e \u003c!--Windows: Sensitive sub-key under file associations and CLSID that map to launch command--\u003e\n\t\t\t\u003cTargetObject name=\"T1122\" condition=\"contains\"\u003e{86C86720-42A0-1069-A2E8-08002B30309D}\u003c/TargetObject\u003e \u003c!--Windows: Tooltip handler--\u003e\n\t\t\t\u003cTargetObject name=\"T1042\" condition=\"contains\"\u003eexefile\u003c/TargetObject\u003e \u003c!--Windows Executable handler, to log any changes not already monitored--\u003e\n\t\t\t\u003c!--Windows COM--\u003e\n\t\t\t\u003cTargetObject name=\"T1122\" condition=\"end with\"\u003e\\InprocServer32\\(Default)\u003c/TargetObject\u003e \u003c!--Windows:COM Object Hijacking [ https://blog.gdatasoftware.com/2014/10/23941-com-object-hijacking-the-discreet-way-of-persistence ] | Credit @ion-storm --\u003e\n\t\t\t\u003c!--Windows shell visual modifications used by malware--\u003e\n\t\t\t\u003cTargetObject name=\"T1158\" condition=\"end with\"\u003e\\Hidden\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Some types of malware try to hide their hidden system files from the user, good signal event --\u003e\n\t\t\t\u003cTargetObject name=\"T1158\" condition=\"end with\"\u003e\\ShowSuperHidden\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Some types of malware try to hide their hidden system files from the user, good signal event [ Example: https://www.symantec.com/security_response/writeup.jsp?docid=2007-061811-4341-99\u0026tabid=2 ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1158\" condition=\"end with\"\u003e\\HideFileExt\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Some malware hides file extensions to make diagnosis/disinfection more daunting to novice users --\u003e\n\t\t\t\u003c!--Windows shell hijack and modifications--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\*\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: [ http://www.silentrunners.org/launchpoints.html ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\AllFilesystemObjects\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: [ http://www.silentrunners.org/launchpoints.html ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\Directory\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\Drive\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\Folder\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: ContextMenuHandlers, DragDropHandlers, CopyHookHandlers, [ https://stackoverflow.com/questions/1323663/windows-shell-context-menu-option ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eClasses\\PROTOCOLS\\\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Protocol handlers--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eContextMenuHandlers\\\u003c/TargetObject\u003e \u003c!--Windows: [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eCurrentVersion\\Shell\u003c/TargetObject\u003e \u003c!--Windows: Shell Folders, ShellExecuteHooks, ShellIconOverloadIdentifers, ShellServiceObjects, ShellServiceObjectDelayLoad [ http://oalabs.openanalysis.net/2015/06/04/malware-persistence-hkey_current_user-shell-extension-handlers/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\explorer\\ShellExecuteHooks\u003c/TargetObject\u003e \u003c!--Windows: ShellExecuteHooks--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\explorer\\ShellServiceObjectDelayLoad\u003c/TargetObject\u003e \u003c!--Windows: ShellExecuteHooks--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\explorer\\ShellIconOverlayIdentifiers\u003c/TargetObject\u003e \u003c!--Windows: ShellExecuteHooks--\u003e\n\t\t\t\u003c!--AppPaths hijacking--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\\u003c/TargetObject\u003e \u003c!--Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] --\u003e\n\t\t\t\u003c!--Terminal service boobytrap--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram\u003c/TargetObject\u003e \u003c!--Windows:RDP: Note other Terminal Server run keys are handled by another wildcard already--\u003e\n\t\t\t\u003c!--Group Policy integrity--\u003e\n\t\t\t\u003cTargetObject name=\"T1484\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GPExtensions\\\u003c/TargetObject\u003e \u003c!--Windows: Group Policy internally uses a plug-in architecture that nothing should be modifying--\u003e\n\t\t\t\u003c!--Winsock and Winsock2--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Services\\WinSock\u003c/TargetObject\u003e \u003c!--Windows: Wildcard, includes Winsock and Winsock2--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\ProxyServer\u003c/TargetObject\u003e \u003c!--Windows: System and user proxy server--\u003e\n\t\t\t\u003c!--Credential providers--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Authentication\\Credential Provider\u003c/TargetObject\u003e \u003c!--Wildcard, includes Credential Providers and Credential Provider Filters--\u003e\n\t\t\t\u003cTargetObject name=\"T1101\" condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\\u003c/TargetObject\u003e \u003c!-- [ https://attack.mitre.org/wiki/Technique/T1131 ] [ https://attack.mitre.org/wiki/Technique/T1101 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SecurityProviders\u003c/TargetObject\u003e \u003c!--Windows: Changes to WDigest-UseLogonCredential for password scraping [ https://www.trustedsec.com/april-2015/dumping-wdigest-creds-with-meterpreter-mimikatzkiwi-in-windows-8-1/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Netsh\u003c/TargetObject\u003e \u003c!--Windows: Netsh helper DLL [ https://attack.mitre.org/wiki/Technique/T1128 ] --\u003e\n\t\t\t\u003c!--Networking--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\NetworkProvider\\Order\\\u003c/TargetObject\u003e \u003c!--Windows: Order of network providers that are checked to connect to destination [ https://www.malwarearchaeology.com/cheat-sheets ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles\u003c/TargetObject\u003e \u003c!--Windows: | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetObject name=\"T1089\" condition=\"end with\"\u003e\\EnableFirewall\u003c/TargetObject\u003e \u003c!--Windows: Monitor for firewall disablement, all firewall profiles [ https://attack.mitre.org/wiki/Technique/T1089 ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1089\" condition=\"end with\"\u003e\\DoNotAllowExceptions\u003c/TargetObject\u003e \u003c!--Windows: Monitor for firewall disablement, all firewall profiles [ https://attack.mitre.org/wiki/Technique/T1089 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\AuthorizedApplications\\List\u003c/TargetObject\u003e \u003c!--Windows Firewall authorized applications for all networks| Credit @ion-storm --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\AuthorizedApplications\\List\u003c/TargetObject\u003e \u003c!--Windows Firewall authorized applications for domain networks --\u003e\n\t\t\t\u003c!--DLLs that get injected into every process at launch--\u003e\n\t\t\t\u003cTargetObject name=\"T1103\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Appinit_Dlls\\\u003c/TargetObject\u003e \u003c!--Windows: Feature disabled by default [ https://attack.mitre.org/wiki/Technique/T1103 ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1103\" condition=\"begin with\"\u003eHKLM\\Software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Appinit_Dlls\\\u003c/TargetObject\u003e \u003c!--Windows: Feature disabled by default [ https://attack.mitre.org/wiki/Technique/T1103 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls\\\u003c/TargetObject\u003e \u003c!--Windows: Credit to @Hexacorn [ http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/ ] [ https://blog.comodo.com/malware/trojware-win32-trojanspy-volisk-a/ ] --\u003e\n\t\t\t\u003c!--Office--\u003e\n\t\t\t\u003cTargetObject name=\"T1137\" condition=\"contains\"\u003eMicrosoft\\Office\\Outlook\\Addins\\\u003c/TargetObject\u003e \u003c!--Microsoft:Office: Outlook add-ins, access to sensitive data and often cause issues--\u003e\n\t\t\t\u003cTargetObject name=\"T1137\" condition=\"contains\"\u003eOffice Test\\\u003c/TargetObject\u003e \u003c!-- Microsoft:Office: Persistence method [ http://www.hexacorn.com/blog/2014/04/16/beyond-good-ol-run-key-part-10/ ] | Credit @Hexacorn --\u003e\n\t\t\t\u003cTargetObject name=\"Context,ProtectedModeExitOrMacrosUsed\" condition=\"contains\"\u003eSecurity\\Trusted Documents\\TrustRecords\u003c/TargetObject\u003e \u003c!--Microsoft:Office: Monitor when \"Enable editing\" or \"Enable macros\" is used | Credit @OutflankNL | [ https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ ] --\u003e\n\t\t\t\u003c!--IE--\u003e\n\t\t\t\u003cTargetObject name=\"T1176\" condition=\"contains\"\u003eInternet Explorer\\Toolbar\\\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Machine and user [ Example: https://www.exterminate-it.com/malpedia/remove-mywebsearch ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1176\" condition=\"contains\"\u003eInternet Explorer\\Extensions\\\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Machine and user [ Example: https://www.exterminate-it.com/malpedia/remove-mywebsearch ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1176\" condition=\"contains\"\u003eBrowser Helper Objects\\\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Machine and user [ https://msdn.microsoft.com/en-us/library/bb250436(v=vs.85).aspx ] --\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\DisableSecuritySettingsCheck\u003c/TargetObject\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\3\\1206\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Malware sometimes assures scripting is on in Internet Zone [ https://support.microsoft.com/en-us/help/182569/internet-explorer-security-zones-registry-entries-for-advanced-users ] --\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\3\\2500\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Malware sometimes disables Protected Mode in Internet Zone [ https://blog.avast.com/2013/08/12/your-documents-are-corrupted-from-image-to-an-information-stealing-trojan/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\3\\1809\u003c/TargetObject\u003e \u003c!--Microsoft:InternetExplorer: Malware sometimes disables Pop-up Blocker in Internet Zone [ https://support.microsoft.com/en-us/help/182569/internet-explorer-security-zones-registry-entries-for-advanced-users ] --\u003e\n\t\t\t\u003c!--Magic registry keys--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Classes\\CLSID\\{AB8902B4-09CA-4BB6-B78D-A8F59079A8D5}\\\u003c/TargetObject\u003e \u003c!--Windows: Thumbnail cache autostart [ http://blog.trendmicro.com/trendlabs-security-intelligence/poweliks-levels-up-with-new-autostart-mechanism/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Classes\\WOW6432Node\\CLSID\\{AB8902B4-09CA-4BB6-B78D-A8F59079A8D5}\\\u003c/TargetObject\u003e \u003c!--Windows: Thumbnail cache autostart [ http://blog.trendmicro.com/trendlabs-security-intelligence/poweliks-levels-up-with-new-autostart-mechanism/ ] --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Classes\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\u003c/TargetObject\u003e \u003c!--Windows: DirectX instances--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Classes\\WOW6432Node\\CLSID\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\u003c/TargetObject\u003e \u003c!--Windows: DirectX instances--\u003e\n\t\t\t\u003c!--Install/Run artifacts--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\UrlUpdateInfo\u003c/TargetObject\u003e \u003c!--Microsoft:ClickOnce: Source URL is stored in this value [ https://subt0x10.blogspot.com/2016/12/mimikatz-delivery-via-clickonce-with.html ] --\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\InstallSource\u003c/TargetObject\u003e \u003c!--Windows: Source folder for certain program and component installations--\u003e\n\t\t\t\u003cTargetObject name=\"Alert,Sysinternals Tool Used\" condition=\"end with\"\u003e\\EulaAccepted\u003c/TargetObject\u003e \u003c!--Sysinternals tool launched. Lots of useful abilities for attackers --\u003e\n\t\t\t\u003c!--Antivirus tampering--\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-Defender\" condition=\"end with\"\u003e\\DisableAntiSpyware\u003c/TargetObject\u003e \u003c!--Windows:Defender: State modified via registry--\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-Defender\" condition=\"end with\"\u003e\\DisableAntiVirus\u003c/TargetObject\u003e \u003c!--Windows:Defender: State modified via registry--\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-Defender\" condition=\"end with\"\u003e\\SpynetReporting\u003c/TargetObject\u003e \u003c!--Windows:Defender: State modified via registry--\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-Defender\" condition=\"end with\"\u003eDisableRealtimeMonitoring\u003c/TargetObject\u003e \u003c!--Windows:Defender: State modified via registry--\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-Defender\" condition=\"end with\"\u003e\\SubmitSamplesConsent\u003c/TargetObject\u003e \u003c!--Windows:Defender: State modified via registry--\u003e\n\t\t\t\u003c!--Windows UAC tampering--\u003e\n\t\t\t\u003cTargetObject name=\"T1088\" condition=\"end with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA\u003c/TargetObject\u003e \u003c!--Detect: UAC Tampering | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetObject name=\"T1088\" condition=\"end with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicy\u003c/TargetObject\u003e \u003c!--Detect: UAC Tampering | Credit @ion-storm --\u003e\n\t\t\t\u003c!--Microsoft Security Center tampering | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-SecCenter\" condition=\"end with\"\u003eHKLM\\Software\\Microsoft\\Security Center\\\u003c/TargetObject\u003e \u003c!-- [ https://attack.mitre.org/wiki/Technique/T1089 ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1089,Tamper-SecCenter\" condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\HideSCAHealth\u003c/TargetObject\u003e \u003c!--Windows:Security Center: Malware sometimes disables [ https://blog.avast.com/2013/08/12/your-documents-are-corrupted-from-image-to-an-information-stealing-trojan/ ] --\u003e\n\t\t\t\u003c!--Windows application compatibility--\u003e\n\t\t\t\u003cTargetObject name=\"T1138,AppCompatShim\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\u003c/TargetObject\u003e \u003c!--Windows: AppCompat [ https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html ] --\u003e\n\t\t\t\u003cTargetObject name=\"T1138,AppCompatShim\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\u003c/TargetObject\u003e \u003c!--Windows: AppCompat [ https://attack.mitre.org/wiki/Technique/T1138 ] --\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eVirtualStore\u003c/TargetObject\u003e \u003c!--Windows: Registry virtualization, something's wrong if it's in use [ https://msdn.microsoft.com/en-us/library/windows/desktop/aa965884(v=vs.85).aspx ] --\u003e\n\t\t\t\u003c!--Windows internals integrity monitoring--\u003e\n\t\t\t\u003cTargetObject name=\"T1183,IFEO\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\\u003c/TargetObject\u003e \u003c!--Windows: Malware likes changing IFEO, like adding Debugger to disable antivirus EXE--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\\u003c/TargetObject\u003e \u003c!--Windows: Event log system integrity and ACLs--\u003e\n\t\t\t\u003cTargetObject name=\"Tamper-Safemode\" condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Safeboot\\\u003c/TargetObject\u003e \u003c!--Windows: Services approved to load in safe mode. Almost nothing should ever modify this.--\u003e\n\t\t\t\u003cTargetObject name=\"Tamper-Winlogon\" condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Winlogon\\\u003c/TargetObject\u003e \u003c!--Windows: Providers notified by WinLogon--\u003e\n\t\t\t\u003cTargetObject name=\"Context,DeviceConntectedOrUpdated\" condition=\"end with\"\u003e\\FriendlyName\u003c/TargetObject\u003e \u003c!--Windows: New devices connected and remembered--\u003e\n\t\t\t\u003cTargetObject name=\"Context,MsiInstallerStarted\" condition=\"is\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Installer\\InProgress\\(Default)\u003c/TargetObject\u003e \u003c!--Windows: See when WindowsInstaller is engaged, useful for timeline matching with other events--\u003e\n\t\t\t\u003cTargetObject name=\"Tamper-Tracing\" condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Tracing\\RASAPI32\u003c/TargetObject\u003e \u003c!--Windows: Malware sometimes disables tracing to obfuscate tracks--\u003e\n            \u003cTargetObject name=\"BCD\" condition=\"begin with\"\u003eHKLM\\BCD00000000\\Objects\u003c/TargetObject\u003e\n            \u003cTargetObject name=\"Internet settings\" condition=\"end with\"\u003eMicrosoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyServer\u003c/TargetObject\u003e\n            \u003cTargetObject name=\"DisableTaskMgr\" condition=\"end with\"\u003eMicrosoft\\Windows\\CurrentVersion\\Policies\\System\\DisableTaskMgr\u003c/TargetObject\u003e\n            \u003cTargetObject name=\"DisableCAD\" condition=\"end with\"\u003e\\CurrentVersion\\Winlogon\\DisableCAD\u003c/TargetObject\u003e\n\t\t\t\u003c!--Windows inventory events--\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-Path\" condition=\"end with\"\u003e\\LowerCaseLongPath\u003c/TargetObject\u003e \u003c!-- [ https://binaryforay.blogspot.com/2017/10/amcache-still-rules-everything-around.html ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-Pub\" condition=\"end with\"\u003e\\Publisher\u003c/TargetObject\u003e \u003c!-- [ https://binaryforay.blogspot.com/2017/10/amcache-still-rules-everything-around.html ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-Ver\" condition=\"end with\"\u003e\\BinProductVersion\u003c/TargetObject\u003e \u003c!-- [ https://docs.microsoft.com/en-us/windows/privacy/basic-level-windows-diagnostic-events-and-fields-1709 ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-DriverVer\" condition=\"end with\"\u003e\\DriverVersion\u003c/TargetObject\u003e \u003c!-- [ https://df-stream.com/2015/02/leveraging-devicecontainers-key/ ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-DriverVer\" condition=\"end with\"\u003e\\DriverVerVersion\u003c/TargetObject\u003e \u003c!-- [ https://df-stream.com/2015/02/leveraging-devicecontainers-key/ ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB-CompileTimeClaim\" condition=\"end with\"\u003e\\LinkDate\u003c/TargetObject\u003e \u003c!-- Compile time of EXE, may not be reliable [ https://en.wikipedia.org/wiki/Link_time ] --\u003e\n\t\t\t\u003cTargetObject name=\"InvDB\" condition=\"contains\"\u003eCompatibility Assistant\\Store\\\u003c/TargetObject\u003e \u003c!-- Inventory --\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\u003c/TargetObject\u003e \u003c!-- SafeDllSearchMode --\u003e\n\t\t\t\u003c!--Suspicious sources--\u003e\n\t\t\t\u003cImage name=\"Suspicious,ImageBeginWithBackslash\" condition=\"begin with\"\u003e\\\u003c/Image\u003e \u003c!--Devices and VSC shouldn't be executing changes | Credit: @SBousseaden @ionstorm @neu5ron @PerchedSystems [ https://twitter.com/SwiftOnSecurity/status/1133167323991486464 ] --\u003e\n\t\t\u003c/RegistryEvent\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cRegistryEvent onmatch=\"exclude\"\u003e\n\t\t\u003c!--COMMENT:\tRemove low-information noise. Often these hide a procress recreating an empty key and do not hide the values created subsequently.--\u003e\n\t\t\u003c!--NOTE:\tA lot of noise can be removed by excluding CreateKey events, which are largely innocuous--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003e\\{CAFEEFAC-\u003c/TargetObject\u003e\n\t\t\t\u003cEventType condition=\"is\"\u003eCreateKey\u003c/EventType\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\COMPONENTS\u003c/TargetObject\u003e\n\t\t\t\u003c!--Inventory noise--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\AppModel\\StateRepository\\Cache\u003c/TargetObject\u003e\n\t\t\t\u003c!--Misc--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eToolbar\\WebBrowser\u003c/TargetObject\u003e \u003c!--Microsoft:IE: Extraneous activity--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eBrowser\\ITBar7Height\u003c/TargetObject\u003e \u003c!--Microsoft:IE: Extraneous activity, covers ShellBrowser and WebBrowser--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eBrowser\\ITBar7Layout\u003c/TargetObject\u003e \u003c!--Microsoft:IE: Extraneous activity--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eInternet Explorer\\Toolbar\\Locked\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Extraneous activity--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eToolbar\\WebBrowser\\{47833539-D0C5-4125-9FA8-0819E2EAAC93}\u003c/TargetObject\u003e \u003c!--Windows:Explorer: Extraneous activity--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e}\\PreviousPolicyAreas\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from \\Winlogon\\GPExtensions by svchost.exe--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003e\\Control\\WMI\\Autologger\\\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Services\\UsoSvc\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\Lsa\\OfflineJoin\\CurrentValue\u003c/TargetObject\u003e \u003c!--Windows: Sensitive value during domain join--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\S-1-5-18\\\u003c/TargetObject\u003e \u003c!--Windows: Remove noise monitoring installations run as system--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003e_Classes\\AppX\u003c/TargetObject\u003e \u003c!--Windows: Remove noise monitoring \"Shell\\open\\command\"--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Publishers\\\u003c/TargetObject\u003e \u003c!--Windows: SvcHost Noise--\u003e\n\t\t\t\u003c!--Bootup Control noise--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\LsaPid\u003c/TargetObject\u003e \u003c!--Windows:lsass.exe: Boot noise--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\SspiCache\u003c/TargetObject\u003e \u003c!--Windows:lsass.exe: Boot noise--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eHKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Kerberos\\Domains\u003c/TargetObject\u003e \u003c!--Windows:lsass.exe: Boot noise--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003c!--Services startup settings noise, some low-risk services routinely change it and this can be ignored--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\Services\\BITS\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\clr_optimization_v2.0.50727_32\\Start\u003c/TargetObject\u003e \u003c!--Microsoft:dotNet: Windows 7--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\clr_optimization_v2.0.50727_64\\Start\u003c/TargetObject\u003e \u003c!--Microsoft:dotNet: Windows 7--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\clr_optimization_v4.0.30319_32\\Start\u003c/TargetObject\u003e \u003c!--Microsoft:dotNet: Windows 10--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\clr_optimization_v4.0.30319_64\\Start\u003c/TargetObject\u003e \u003c!--Microsoft:dotNet: Windows 10--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\deviceAssociationService\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\fhsvc\\Start\u003c/TargetObject\u003e \u003c!--Windows: File History Service--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\nal\\Start\u003c/TargetObject\u003e \u003c!--Intel: Network adapter diagnostic driver--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\trustedInstaller\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\tunnel\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\services\\usoSvc\\Start\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"\\Start\"--\u003e\n\t\t\t\u003c!--FileExts noise filtering--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\UserChoice\\ProgId\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"FileExts\"--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\UserChoice\\Hash\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"FileExts\"--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003e\\OpenWithList\\MRUList\u003c/TargetObject\u003e \u003c!--Windows: Remove noise from monitoring \"FileExts\"--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eShell Extentions\\Cached\u003c/TargetObject\u003e \u003c!--Windows: Remove noise generated by explorer.exe on monitored ShellCached binary keys--\u003e \u003c!--Win8+--\u003e\n\t\t\t\u003c!--Group Policy noise--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eHKLM\\System\\CurrentControlSet\\Control\\Lsa\\Audit\\SpecialGroups\u003c/TargetObject\u003e \u003c!--Windows: Routinely set through Group Policy, not especially important to log--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\\0\\PSScriptOrder\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\\0\\SOM-ID\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\\0\\GPO-ID\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\\0\\0\\IsPowershell\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Startup\\0\\0\\ExecTime\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown\\0\\PSScriptOrder\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown\\0\\SOM-ID\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown\\0\\GPO-ID\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown\\0\\0\\IsPowershell\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"end with\"\u003eSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Group Policy\\Scripts\\Shutdown\\0\\0\\ExecTime\u003c/TargetObject\u003e \u003c!--Windows:Group Policy: Noise below the actual key while building--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003e\\safer\\codeidentifiers\\0\\HASHES\\{\u003c/TargetObject\u003e \u003c!--Windows: Software Restriction Policies. Can be used to disable security tools, but very noisy to monitor if you use it--\u003e\n\t\t\t\u003c!--SECTION: Office C2R--\u003e\n\t\t\t\u003cTargetObject condition=\"contains\"\u003eVirtualStore\\MACHINE\\SOFTWARE\\Microsoft\\Office\\ClickToRun\\\u003c/TargetObject\u003e \u003c!--Microsoft: SearchProtocolHost writes to OfficeC2R registry for Outlook, seemingly regarding mail indexing--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKLM\\SOFTWARE\\Microsoft\\Office\\ClickToRun\\\u003c/TargetObject\u003e \u003c!--Microsoft: Virtual registry for Office--\u003e\n\t\t\t\u003c!--SECTION: 3rd party--\u003e\n\t\t\t\u003cImage condition=\"is\"\u003eC:\\Program Files\\WIDCOMM\\Bluetooth Software\\btwdins.exe\u003c/Image\u003e \u003c!--Constantly writes to HKLM--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKCR\\VLC.\u003c/TargetObject\u003e \u003c!--VLC update noise--\u003e\n\t\t\t\u003cTargetObject condition=\"begin with\"\u003eHKCR\\iTunes.\u003c/TargetObject\u003e \u003c!--Apple: iTunes update noise--\u003e\n\t\t\t\u003c!--WINEVT publishers noise--\u003e\n\t\t\t\u003cTargetObject condition=\"is\"\u003eHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Publishers\\{945a8954-c147-4acd-923f-40c45405a658}\u003c/TargetObject\u003e \u003c!--Windows update--\u003e\n\t\t\u003c/RegistryEvent\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 15 : ALTERNATE DATA STREAM CREATED [FileCreateStreamHash]--\u003e\n\t\t\u003c!--EVENT 15: \"File stream created\"--\u003e\n\t\t\u003c!--COMMENT:\tAny files created with an NTFS Alternate Data Stream which match these rules will be hashed and logged.\n\t\t\t[ https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/ ]\n\t\t\tADS's are used by browsers and email clients to mark files as originating from the Internet or other foreign sources.\n\t\t\t[ https://textslashplain.com/2016/04/04/downloads-and-the-mark-of-the-web/ ] --\u003e\n\t\t\u003c!--NOTE: Other filesystem minifilters can make it appear to Sysmon that some files are being written twice. This is not a Sysmon issue, per Mark Russinovich.--\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, Image, TargetFilename, CreationUtcTime, Hash--\u003e\n\t\t\u003cFileCreateStreamHash onmatch=\"include\"\u003e\n\t\t\t\u003cTargetFilename condition=\"contains\"\u003eDownloads\u003c/TargetFilename\u003e \u003c!--Downloaded files. Does not include \"Run\" files in IE--\u003e\n\t\t\t\u003cTargetFilename condition=\"contains\"\u003eTemp\\7z\u003c/TargetFilename\u003e \u003c!--7zip extractions--\u003e\n\t\t\t\u003cTargetFilename condition=\"contains\"\u003eStartup\u003c/TargetFilename\u003e \u003c!--ADS startup | Example: [ https://www.hybrid-analysis.com/sample/a314f6106633fba4b70f9d6ddbee452e8f8f44a72117749c21243dc93c7ed3ac?environmentId=100 ] --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.bat\u003c/TargetFilename\u003e \u003c!--Batch scripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.cmd\u003c/TargetFilename\u003e \u003c!--Batch scripting | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.doc\u003c/TargetFilename\u003e \u003c!--Office doc potentially with macro --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.hta\u003c/TargetFilename\u003e \u003c!--Scripting--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.lnk\u003c/TargetFilename\u003e \u003c!--Shortcut file | Credit @ion-storm --\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.ppt\u003c/TargetFilename\u003e \u003c!--Office doc potentially with macros--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.ps1\u003c/TargetFilename\u003e \u003c!--PowerShell--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.ps2\u003c/TargetFilename\u003e \u003c!--PowerShell--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.reg\u003c/TargetFilename\u003e \u003c!--Registry File--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.jse\u003c/TargetFilename\u003e \u003c!--Registry File--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.vb\u003c/TargetFilename\u003e \u003c!--VisualBasicScripting files--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.vbe\u003c/TargetFilename\u003e \u003c!--VisualBasicScripting files--\u003e\n\t\t\t\u003cTargetFilename condition=\"end with\"\u003e.vbs\u003c/TargetFilename\u003e \u003c!--VisualBasicScripting files--\u003e\n\t\t\u003c/FileCreateStreamHash\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cFileCreateStreamHash onmatch=\"exclude\"\u003e\n\t\t\u003c/FileCreateStreamHash\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 16 : SYSMON CONFIGURATION CHANGE--\u003e\n\t\t\u003c!--EVENT 16: \"Sysmon config state changed\"--\u003e\n\t\t\u003c!--COMMENT:\tThis ONLY logs if the hash of the configuration changes. Running \"sysmon.exe -c\" with the current configuration will not be logged with Event 16--\u003e\n\t\t\n\t\t\u003c!--DATA: UtcTime, Configuration, ConfigurationFileHash--\u003e\n\t\t\u003c!--Cannot be filtered.--\u003e\n\n\t\u003c!--SYSMON EVENT ID 17 \u0026 18 : PIPE CREATED / PIPE CONNECTED [PipeEvent]--\u003e\n\t\t\u003c!--EVENT 17: \"Pipe Created\"--\u003e\n\t\t\u003c!--EVENT 18: \"Pipe Connected\"--\u003e\n\n\t\t\u003c!--ADDITIONAL REFERENCE: [ https://www.cobaltstrike.com/help-smb-beacon ] --\u003e\n\t\t\u003c!--ADDITIONAL REFERENCE: [ https://blog.cobaltstrike.com/2015/10/07/named-pipe-pivoting/ ] --\u003e\n\n\t\t\u003c!--DATA: UtcTime, ProcessGuid, ProcessId, PipeName, Image--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cPipeEvent onmatch=\"include\"\u003e\n\t\t\t\u003c!--NOTE: Using incide with no rules means nothing in this section will be logged--\u003e\n\t\t\u003c/PipeEvent\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 19 \u0026 20 \u0026 21 : WMI EVENT MONITORING [WmiEvent]--\u003e\n\t\t\u003c!--EVENT 19: \"WmiEventFilter activity detected\"--\u003e\n\t\t\u003c!--EVENT 20: \"WmiEventConsumer activity detected\"--\u003e\n\t\t\u003c!--EVENT 21: \"WmiEventConsumerToFilter activity detected\"--\u003e\n\n\t\t\u003c!--ADDITIONAL REFERENCE: [ https://www.darkoperator.com/blog/2017/10/15/sysinternals-sysmon-610-tracking-of-permanent-wmi-events ] --\u003e\n\t\t\u003c!--ADDITIONAL REFERENCE: [ https://rawsec.lu/blog/posts/2017/Sep/19/sysmon-v610-vs-wmi-persistence/ ] --\u003e\n\n\t\t\u003c!--DATA: EventType, UtcTime, Operation, User, Name, Type, Destination, Consumer, Filter--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cWmiEvent onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--NOTE: Using exclude with no rules means everything will be logged--\u003e\n\t\t\u003c/WmiEvent\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 22 : DNS QUERY [DnsQuery]--\u003e\n\t\t\u003c!--EVENT 22: \"Dns query\"--\u003e\n\n\t\t\u003c!--NOTE:\tDue to the volume of events that DNS queries generate, some orgs may want to remove this section from their configuration to reduce Sysmon log turnover. --\u003e\n\n\t\t\u003c!--COMMENT:\tDNS logging is a very nuanced challenge in monitoring due to event volume. Legitimate domains can be used to host malware/C2, but lookup itself is not very informative.\n\t\t\t\t\t\tIt's fine to exclude monitoring these bulk low-value lookups, but at same time, you would not have a full log of how malware communicated, potentially missing C2.\n\t\t\t\t\t\tThis section of Sysmon configuration will require your full judgement and knowledge of your org's priorities. There is no correct answer.--\u003e\n\n\t\t\u003c!--OPERATIONS:\tChrome and Firefox prefetch DNS lookups, or use alternate DNS lookup methods Sysmon won't capture. You need to turn these off.\n\t\t\t\t\t\tSearch for Group Policy for these browsers to configure this.--\u003e\n\n\t\t\u003c!--OPERATIONS:\tMost DNS traffic is web advertising. To significantly reduce DNS queries and malware ads, enable client-side advertising filtering via Group Policy. This is easy.\n\t\t\t\tInternet Explorer: https://decentsecurity.com/adblocking-for-internet-explorer-deployment/\n\t\t\t\tChrome: https://decentsecurity.com/ublock-for-google-chrome-deployment/\n\t\t\t\tFirefox: ToDo\n\t\t\t\t\t\tAlso note, this configuration is designed for United States computers. Your country's users will may need customization to reduce noise.\n\t\t\t--\u003e\n\n\t\t\u003c!--CONFIG:\tDNS poisoning is an issue during threat investigations. Try to only exclude ROUTINE system-level queries you know are strongly validated with HTTPS or code signing.--\u003e\n\t\t\u003c!--CONFIG:\tIf you exclude microsoft.com, someone could register malware-microsoft.com and it wouldn't be logged. Use \"END WITH\" with leading . or \"IS\" operators.--\u003e\n\t\t\u003c!--CONFIG:\tBe very specific in exclusions. Threat actors use legitimate services, too. Dont exclude all of AWS or Azure or Google or CDNs!--\u003e\n\t\t\u003c!--CONFIG: Popularity data: [ http://s3-us-west-1.amazonaws.com/umbrella-static/index.html ] [ https://better.fyi/trackers/alexa-top-500-news/ ] --\u003e\n\n\t\t\u003c!--CRITICAL:\tDo NOT exclude \"wpad\" lookups. This is a MitM vector routinely used by attackers. Disable WPAD or enforce client-side DNSSEC for AD domain lookups.--\u003e\n\t\t\u003c!--CRITICAL:\tDo NOT exclude IPv6 lookups.--\u003e\n\n\t\t\u003c!--DATA: RuleName, UtcTime, ProcessGuid, ProcessId, QueryName, QueryType, QueryStatus, QueryResults (can't filter on)--\u003e\n\n\t\t\u003c!--BELOW: These domains should not be excluded at the top level. Be specific if you want to reduce noise under them.--\u003e\n\t\t\u003c!-- Rejected: .cloudapp.net, customer content [ https://blogs.technet.microsoft.com/ptsblog/2012/06/18/security-consideration-when-using-cloudapp-net-domain-as-production-environment-in-windows-azure/ ] --\u003e\n\t\t\u003c!-- Rejected: .googleapis.com, customer content [ https://www.zdnet.com/article/this-business-email-scam-spreads-trojans-through-google-cloud-storage/ ] --\u003e\n\t\t\u003c!-- Rejected: .cloudfront.net, customer content --\u003e\n\t\t\u003c!-- Rejected: .windows.net, customer content --\u003e\n\t\t\u003c!-- Rejected: *github.com, customer content, including open-source malware components --\u003e\n\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cDnsQuery onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--Network noise--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.arpa.\u003c/QueryName\u003e \u003c!--Design decision to not log reverse DNS lookups. You will need to decide.--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.arpa\u003c/QueryName\u003e \u003c!--Design decision to not log reverse DNS lookups. You will need to decide.--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msftncsi.com\u003c/QueryName\u003e \u003c!--Microsoft proxy detection | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003e..localmachine\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003elocalhost\u003c/QueryName\u003e\n\t\t\t\u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e-pushp.svc.ms\u003c/QueryName\u003e \u003c!--Microsoft: Doesn't appear to host customer content or subdomains--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.b-msedge.net\u003c/QueryName\u003e \u003c!--Microsoft: Doesn't appear to host customer content or subdomains--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.bing.com\u003c/QueryName\u003e \u003c!-- Microsoft | Microsoft default exclusion --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.hotmail.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.live.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.live.net\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.s-microsoft.com\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.microsoft.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.microsoftonline.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.microsoftstore.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.ms-acdc.office.com\u003c/QueryName\u003e \u003c!--Microsoft: Doesn't appear to host customer content or subdomains--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msedge.net\u003c/QueryName\u003e \u003c!--Microsoft: Doesn't appear to host customer content or subdomains--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msn.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msocdn.com\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.skype.com\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.skype.net\u003c/QueryName\u003e \u003c!--Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.windows.com\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.windows.net.nsatc.net\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.windowsupdate.com\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.xboxlive.com\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003elogin.windows.net\u003c/QueryName\u003e \u003c!--Microsoft--\u003e\n\t\t\t\u003cImage condition=\"begin with\"\u003eC:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\\u003c/Image\u003e \u003c!--Microsoft: https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/network-protection --\u003e\n\t\t\t\u003c!--Microsoft:Office365/AzureAD--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.activedirectory.windowsazure.com\u003c/QueryName\u003e \u003c!--Microsoft: AzureAD--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.aria.microsoft.com\u003c/QueryName\u003e \u003c!--Microsoft: OneDrive/SharePoint--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msauth.net\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.msftauth.net\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.opinsights.azure.com\u003c/QueryName\u003e \u003c!--Microsoft: AzureAD/InTune client event monitoring--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003eosi.office.net\u003c/QueryName\u003e \u003c!--Microsoft: Office--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eloki.delve.office.com\u003c/QueryName\u003e \u003c!--Microsoft: Office--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003emanagement.azure.com\u003c/QueryName\u003e \u003c!--Microsoft: AzureAD/InTune--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003emessaging.office.com\u003c/QueryName\u003e \u003c!--Microsoft: Office--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eoutlook.office365.com\u003c/QueryName\u003e \u003c!--Microsoft: Protected by HSTS--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eportal.azure.com\u003c/QueryName\u003e \u003c!--Microsoft: AzureAD/InTune--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eprotection.outlook.com\u003c/QueryName\u003e \u003c!--Microsoft: Office--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003esubstrate.office.com\u003c/QueryName\u003e \u003c!--Microsoft: Office--\u003e\n\t\t\t\u003c!--3rd-party applications--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mozaws.net\u003c/QueryName\u003e \u003c!--Mozilla--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mozilla.com\u003c/QueryName\u003e \u003c!--Mozilla--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mozilla.net\u003c/QueryName\u003e \u003c!--Mozilla--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mozilla.org\u003c/QueryName\u003e \u003c!--Mozilla--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.spotify.com\u003c/QueryName\u003e \u003c!--Spotify--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.spotify.map.fastly.net\u003c/QueryName\u003e \u003c!--Spotify--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients1.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients2.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients3.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients4.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients5.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclients6.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003esafebrowsing.googleapis.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003c!--Goodlist CDN--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.akadns.net\u003c/QueryName\u003e \u003c!--AkamaiCDN, extensively used by Microsoft | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.netflix.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003easpnetcdn.com\u003c/QueryName\u003e \u003c!--Microsoft [ https://docs.microsoft.com/en-us/aspnet/ajax/cdn/overview ]--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eajax.googleapis.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003ecdnjs.cloudflare.com\u003c/QueryName\u003e \u003c!--Cloudflare: Hosts popular javascript libraries--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003efonts.googleapis.com\u003c/QueryName\u003e \u003c!--Google fonts--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.typekit.net\u003c/QueryName\u003e \u003c!--Adobe fonts--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003ecdnjs.cloudflare.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.stackassets.com\u003c/QueryName\u003e \u003c!--Stack Overflow--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.steamcontent.com\u003c/QueryName\u003e\n\t\t\t\u003c!--Web resources--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.disqus.com\u003c/QueryName\u003e \u003c!--Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.fontawesome.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003edisqus.com\u003c/QueryName\u003e \u003c!--Microsoft default exclusion--\u003e\n\t\t\t\u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.1rx.io\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.2mdn.net\u003c/QueryName\u003e \u003c!--Ads: Google | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adadvisor.net\u003c/QueryName\u003e \u003c!--Ads: Neustar [ https://better.fyi/trackers/adadvisor.net/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adap.tv\u003c/QueryName\u003e \u003c!--Ads:AOL | Microsoft default exclusion [ https://www.crunchbase.com/organization/adap-tv ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.addthis.com\u003c/QueryName\u003e \u003c!--Ads:Oracle | Microsoft default exclusion [ https://en.wikipedia.org/wiki/AddThis ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adform.net\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adnxs.com\u003c/QueryName\u003e \u003c!--Ads: AppNexus | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adroll.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adrta.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adsafeprotected.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.adsrvr.org\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.advertising.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.amazon-adsystem.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.amazon-adsystem.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.analytics.yahoo.com\u003c/QueryName\u003e \u003c!--Ads:Yahoo--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.aol.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.betrad.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.bidswitch.net\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.casalemedia.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.chartbeat.net\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion [ https://better.fyi/trackers/chartbeat.com/ ]--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.cnn.com\u003c/QueryName\u003e \u003c!-- Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.convertro.com\u003c/QueryName\u003e \u003c!--Ads:Verizon--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.criteo.com\u003c/QueryName\u003e \u003c!--Ads [ https://better.fyi/trackers/criteo.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.criteo.net\u003c/QueryName\u003e \u003c!--Ads [ https://better.fyi/trackers/criteo.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.crwdcntrl.net\u003c/QueryName\u003e \u003c!--Ads: Lotame [ https://better.fyi/trackers/crwdcntrl.net/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.demdex.net\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.domdex.com\u003c/QueryName\u003e \n\t\t\t\u003cQueryName condition=\"end with\"\u003e.dotomi.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.doubleclick.net\u003c/QueryName\u003e \u003c!--Ads:Conversant | Microsoft default exclusion [ https://www.crunchbase.com/organization/dotomi ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.doubleverify.com\u003c/QueryName\u003e \u003c!--Ads: Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.emxdgt.com\u003c/QueryName\u003e \u003c!--Ads: EMX--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.exelator.com\u003c/QueryName\u003e \u003c!--Ads:Nielson Marketing Cloud--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.google-analytics.com\u003c/QueryName\u003e \u003c!--Ads:Google | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.googleadservices.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.googlesyndication.com\u003c/QueryName\u003e \u003c!--Ads:Google, sometimes called during malicious ads, but not directly responsible | Microsoft default exclusion [ https://www.hackread.com/wp-content/uploads/2018/06/Bitdefender-Whitepaper-Zacinlo.pdf ]--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.googletagmanager.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.googlevideo.com\u003c/QueryName\u003e \u003c!--Google | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.gstatic.com\u003c/QueryName\u003e \u003c!--Google | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.gvt1.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.gvt2.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.ib-ibi.com\u003c/QueryName\u003e \u003c!--Ads: Offerpath [ https://better.fyi/trackers/ib-ibi.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.jivox.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mathtag.com\u003c/QueryName\u003e \u003c!--Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.moatads.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.moatpixel.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.mookie1.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.myvisualiq.net\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.netmng.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.nexac.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.openx.net\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.optimizely.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.outbrain.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.pardot.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.phx.gbl\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.pinterest.com\u003c/QueryName\u003e \u003c!--Pinerest--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.pubmatic.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.quantcount.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.quantserve.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.revsci.net\u003c/QueryName\u003e \u003c!--Ads:Omniture | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.rfihub.net\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.rlcdn.com\u003c/QueryName\u003e \u003c!--Ads: Rapleaf [ https://better.fyi/trackers/rlcdn.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.rubiconproject.com\u003c/QueryName\u003e \u003c!--Ads: Rubicon Project | Microsoft default exclusion [ https://better.fyi/trackers/rubiconproject.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.scdn.co\u003c/QueryName\u003e \u003c!--Spotify--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.scorecardresearch.com\u003c/QueryName\u003e \u003c!--Ads: Comscore | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.serving-sys.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.sharethrough.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.simpli.fi\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.sitescout.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.smartadserver.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.snapads.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.spotxchange.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.taboola.com\u003c/QueryName\u003e \u003c!--Ads:Taboola--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.taboola.map.fastly.net\u003c/QueryName\u003e \u003c!--Ads:Taboola--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.tapad.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.tidaltv.com\u003c/QueryName\u003e \u003c!--Ads: Videology [ https://better.fyi/trackers/tidaltv.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.trafficmanager.net\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.tremorhub.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.tribalfusion.com\u003c/QueryName\u003e \u003c!--Ads: Exponential [ https://better.fyi/trackers/tribalfusion.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.turn.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion [ https://better.fyi/trackers/turn.com/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.twimg.com\u003c/QueryName\u003e \u003c!--Ads | Microsoft default exclusion--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.tynt.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.w55c.net\u003c/QueryName\u003e \u003c!--Ads:dataxu--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.ytimg.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.zorosrv.com\u003c/QueryName\u003e \u003c!--Ads:Taboola--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003e1rx.io\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eadservice.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eampcid.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eclientservices.googleapis.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003egoogleadapis.l.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eimasdk.googleapis.com\u003c/QueryName\u003e \u003c!--Google [ https://developers.google.com/interactive-media-ads/docs/sdks/html5/ ] --\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003el.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eml314.com\u003c/QueryName\u003e \u003c!--Ads--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003emtalk.google.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eupdate.googleapis.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003ewww.googletagservices.com\u003c/QueryName\u003e \u003c!--Google--\u003e\n\t\t\t\u003c!--SocialNet--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.pscp.tv\u003c/QueryName\u003e \u003c!--Twitter:Periscope--\u003e\n\t\t\t\u003c!--OSCP/CRL Common--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.digicert.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.globalsign.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.globalsign.net\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003emsocsp.com\u003c/QueryName\u003e \u003c!--Microsoft:OCSP--\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.msocsp.com\u003c/QueryName\u003e \u003c!--Microsoft:OCSP--\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003epki.goog\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.godaddy.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003eamazontrust.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.sectigo.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003epki-goog.l.google.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003e.usertrust.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.comodoca.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.verisign.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.entrust.net\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"end with\"\u003eocsp.identrust.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003estatus.rapidssl.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003estatus.thawte.com\u003c/QueryName\u003e\n\t\t\t\u003cQueryName condition=\"is\"\u003eocsp.int-x3.letsencrypt.org\u003c/QueryName\u003e\n\t\t\u003c/DnsQuery\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 25 : PROCESS IMAGE CHANGE [ProcessTampering]--\u003e\n\t\u003cRuleGroup name=\"\" groupRelation=\"or\"\u003e\n\t\t\u003cProcessTampering onmatch=\"exclude\"\u003e\n\t\t\t\u003c!--NOTE: Using exclude with no rules means everything will be logged--\u003e\n\t\t\u003c/ProcessTampering\u003e\n\t\u003c/RuleGroup\u003e\n\n\t\u003c!--SYSMON EVENT ID 255 : ERROR--\u003e\n\t\t\u003c!--\"This event is generated when an error occurred within Sysmon. They can happen if the system is under heavy load\n\t\t\tand certain tasked could not be performed or a bug exists in the Sysmon service. You can report any bugs on the\n\t\t\tSysinternals forum or over Twitter (@markrussinovich).\"--\u003e\n\t\t\u003c!--Cannot be filtered.--\u003e\n\n\t\u003c/EventFiltering\u003e\n\u003c/Sysmon\u003e"
}